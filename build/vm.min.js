'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var Vue = _interopDefault(require('vue'));

function _typeof(obj) {
  if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {
    _typeof = function (obj) {
      return typeof obj;
    };
  } else {
    _typeof = function (obj) {
      return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
    };
  }

  return _typeof(obj);
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};
    var ownKeys = Object.keys(source);

    if (typeof Object.getOwnPropertySymbols === 'function') {
      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {
        return Object.getOwnPropertyDescriptor(source, sym).enumerable;
      }));
    }

    ownKeys.forEach(function (key) {
      _defineProperty(target, key, source[key]);
    });
  }

  return target;
}

function _objectWithoutPropertiesLoose(source, excluded) {
  if (source == null) return {};
  var target = {};
  var sourceKeys = Object.keys(source);
  var key, i;

  for (i = 0; i < sourceKeys.length; i++) {
    key = sourceKeys[i];
    if (excluded.indexOf(key) >= 0) continue;
    target[key] = source[key];
  }

  return target;
}

function _objectWithoutProperties(source, excluded) {
  if (source == null) return {};

  var target = _objectWithoutPropertiesLoose(source, excluded);

  var key, i;

  if (Object.getOwnPropertySymbols) {
    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);

    for (i = 0; i < sourceSymbolKeys.length; i++) {
      key = sourceSymbolKeys[i];
      if (excluded.indexOf(key) >= 0) continue;
      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;
      target[key] = source[key];
    }
  }

  return target;
}

function _toConsumableArray(arr) {
  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();
}

function _arrayWithoutHoles(arr) {
  if (Array.isArray(arr)) {
    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];

    return arr2;
  }
}

function _iterableToArray(iter) {
  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter);
}

function _nonIterableSpread() {
  throw new TypeError("Invalid attempt to spread non-iterable instance");
}

/**
 * 判断浏览器是否支持passive, 默认preventDefault无效
 */
var isPassiveSupported = function () {
  var status = false;

  try {
    var opts = Object.defineProperty({}, "passive", {
      get: function get() {
        status = true;
        return;
      }
    });
    window.addEventListener('test', null, opts);
  } catch (err) {
    console.log(err);
  }

  return status;
}();
/**
 * 判断是否存在
 */

var hasOwn = function hasOwn(target, key) {
  return Object.prototype.hasOwnProperty.call(target, key);
};
/**
 * 深拷贝
 */

var baseClone = function baseClone(target, source) {
  for (var k in source) {
    // 只拷贝实例属性，不进行原型的拷贝
    if (hasOwn(source, k)) {
      // 引用类型的数据单独处理
      if (_typeof(source[k]) == 'object') {
        target[k] = Array.isArray(source[k]) ? [] : {}; // 递归处理引用类型数据(利用引用处理)

        baseClone(target[k], source[k]);
      } else {
        // 值类型的数据直接进行拷贝
        target[k] = source[k];
      }
    }
  }

  return target;
};

var cloneDeep = function cloneDeep(source) {
  return baseClone(Array.isArray(source) ? [] : {}, source);
};
/**
 * getUid
 */

var now = +new Date();
var index = 0;
var getUid = function getUid() {
  return "vm-".concat(now, "-").concat(++index);
};
/**
 * 判断是否是NaN
 */

/* eslint-disable no-self-compare */

var valueIsNaN = function valueIsNaN(v) {
  return v !== v;
};
/**
 * 清楚vue对组件的缓存
 */

var clearCtor = function clearCtor(obj) {
  var target = cloneDeep(obj);

  for (var key in target) {
    if (target[key]._Ctor) {
      target[key]._Ctor = null;
    }
  }

  return target;
};
/**
 * 是否符合条件
 * @exceptions {
 *    id,
 *    tagName,
 *    className,
 *    ...HTMLElement
 * }
 */

var eleInRegExp = function eleInRegExp(el, exceptions) {
  for (var i in exceptions) {
    if (exceptions[i].test(el[i])) {
      return true;
    }
  }

  return false;
};

//
var doc$1 = document.documentElement;
var angleArr = [0, 45, 90, 135, 180, 225, 270, 315, 360];
var script = {
  replace: true,
  name: 'vm-draggable',
  props: {
    disable: {
      type: Boolean,
      default: false
    },
    handles: {
      type: Array,
      default: function _default() {
        return ['top', 'right', 'bottom', 'left', 'top-left', 'top-right', 'bottom-right', 'bottom-left', 'rotate'];
      }
    },
    // 宽度
    w: {
      type: Number,
      default: 0,
      validator: function validator(val) {
        return val >= 0;
      }
    },
    // 高度
    h: {
      type: Number,
      default: 0,
      validator: function validator(val) {
        return val >= 0;
      }
    },
    // 选择角度
    r: {
      type: Number,
      default: 0
    },
    // 最小宽度
    minw: {
      type: Number,
      default: 36,
      validator: function validator(val) {
        return val > 0;
      }
    },
    // 最小高度
    minh: {
      type: Number,
      default: 36,
      validator: function validator(val) {
        return val > 0;
      }
    },
    // 距父元素左上角X轴偏移量
    x: {
      type: Number,
      default: 0
    },
    // 距父元素左上角Y轴偏移量
    y: {
      type: Number,
      default: 0
    },
    // zIndex
    z: {
      type: Number,
      default: 1
    },
    zoom: {
      type: Number,
      default: 1
    },
    grid: {
      type: Array,
      default: function _default() {
        return [1, 1];
      }
    },
    // 约束组件大小
    restrain: {
      type: Number,
      default: 0
    },
    parent: {
      type: Boolean,
      default: false
    },
    editorRegExp: {
      type: Object,
      default: function _default() {
        return {
          className: /vm-hack-editor/
        };
      }
    },

    /**
     * 是否屏蔽默认事件
     */
    prevent: {
      type: Boolean,
      default: true
    },
    preventRegExp: {
      type: Object,
      default: function _default() {
        return {
          tagName: /^(INPUT|TEXTAREA|BUTTON|SELECT|OPTION)$/,
          className: /vm-hack-pevent/
        };
      }
    }
  },
  data: function data() {
    return {
      resizable: false,
      draggable: false,
      rotatable: false,
      changing: false,
      active: false
    };
  },
  computed: {
    coord: function coord() {
      return {
        left: this.x + 'px',
        top: this.y + 'px',
        zIndex: this.z
      };
    },
    style: function style() {
      var w = this.w === 0 ? 'auto' : "".concat(this.w, "px");
      var h = this.h === 0 ? 'auto' : "".concat(this.h, "px");
      return {
        width: w,
        height: h,
        transform: "rotate(".concat(this.r, "deg)")
      };
    },
    width: function width() {
      var num = Math.floor(Math.sqrt(this.w * this.w + this.h * this.h) * 1.15);
      return "".concat(num, "px");
    }
  },
  watch: {},
  beforeCreate: function beforeCreate() {
    this.parentX = 0;
    this.parentY = 0;
    this.parentW = 9999;
    this.parentH = 9999;
    this.mouseX = 0;
    this.mouseY = 0;
    this.lastMouseX = 0;
    this.lastMouseY = 0;
    this.mouseOffX = 0;
    this.mouseOffY = 0;
    this.handle = null; // 组件捕获阶段执行

    this.eventOpts = !isPassiveSupported || {
      capture: true,
      passive: true
    }; // 改变前状态

    this.beforeStatus = null;
  },
  mounted: function mounted() {
    // 初始化控件宽高, todo: 宽高未零时，是否需要计算
    if (this.w && this.minw > this.w) {
      this.sync({
        w: this.minw
      });
    }

    if (this.h && this.minh > this.h) {
      this.sync({
        h: this.minh
      });
    }

    var _this$$el$parentNode$ = this.$el.parentNode.getBoundingClientRect(),
        x = _this$$el$parentNode$.x,
        y = _this$$el$parentNode$.y;

    this.parentX = x;
    this.parentY = y; // 判断是否只能在父级元素中拖动

    this.parent && this.calculation();
    this.$emit('resizing');
  },
  destroyed: function destroyed() {
    this.operateDOMEvents('remove');
  },
  methods: {
    calculation: function calculation() {
      var _this$$el$parentNode$2 = this.$el.parentNode.getBoundingClientRect(),
          width = _this$$el$parentNode$2.width,
          height = _this$$el$parentNode$2.height;

      this.parentW = width;
      this.parentH = height; // this.$el.parentNode.clientHeight

      if (this.w > this.parentW) {
        this.sync({
          w: this.parentW
        });
      }

      if (this.h > this.parentH) {
        this.sync({
          h: this.parentH
        });
      }

      if (this.x + this.w > this.parentW) {
        this.sync({
          x: this.parentW - this.w
        });
      }

      if (this.y + this.h > this.parentH) {
        this.sync({
          y: this.parentH - this.h
        });
      }
    },
    sync: function sync(opts) {
      for (var key in opts) {
        if (this[key] != opts[key]) {
          !this.beforeStatus && (this.beforeStatus = {
            x: this.x,
            y: this.y,
            z: this.z,
            w: this.w,
            r: this.r
          });
          this.$emit("update:".concat(key), opts[key]);
        }
      }
    },
    operateDOMEvents: function operateDOMEvents(type) {
      var fn = type === 'add' ? doc$1.addEventListener : doc$1.removeEventListener;
      fn('mousedown', this.handleDeselect, this.eventOpts);
      fn('mousemove', this.handleMove, this.eventOpts);
      fn('mouseup', this.handleUp, this.eventOpts);
    },

    /**
     * 模拟设置active状态
     */
    setActived: function setActived() {
      this.handleContainerDown();
      this.handleUp();
    },

    /**
     * 组件被按下事件
     */
    handleContainerDown: function handleContainerDown() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      // 去除默认事件 todo: 匹配输入框
      this.prevent && e.preventDefault && !eleInRegExp(e.target, this.preventRegExp) && e.preventDefault(); // 判断是否支持拖动

      if (this.disable) { return; }
      var target = e.target || e.srcElement; // 确保事件发生在组件内部

      if (!target || this.$el.contains(target)) {
        if (!this.active) {
          this.lastMouseX = e.pageX || e.clientX + doc$1.scrollLeft;
          this.lastMouseY = e.pageY || e.clientY + doc$1.scrollTop; // 绑定事件

          this.operateDOMEvents('add');
          this.active = true;
          this.$emit('activated');
        }

        this.draggable = true;
      }
    },

    /**
     * 取消选择事件
     */
    handleDeselect: function handleDeselect(e) {
      var _this = this;

      this.mouseX = e.pageX || e.clientX + doc$1.scrollLeft;
      this.mouseY = e.pageY || e.clientY + doc$1.scrollTop;
      this.lastMouseX = this.mouseX;
      this.lastMouseY = this.mouseY;
      var target = e.target || e.srcElement; // body不要带上class, 否则会存在问题
      // 内部管理

      var regex = {
        className: /handle-([(top|right|-|bottom|left)]{2})/
      };
      var path = e.path || e.composedPath && e.composedPath() || [];

      if (!this.$el.contains(target) && !eleInRegExp(target, regex) && !path.some(function (item) {
        return eleInRegExp(item, _this.editorRegExp);
      })) {
        if (this.active) {
          // 解绑
          this.operateDOMEvents('remove');
          this.active = false;
          this.$emit('deactivated');
        }
      }
    },

    /**
     * 拖动点按下事件
     */
    handleDown: function handleDown(e, handle) {
      // 去除默认事件 todo: 匹配输入框
      this.prevent && e.preventDefault && !eleInRegExp(e.target, this.preventRegExp) && e.preventDefault(); // 将handle设置为当前元素

      this.handle = handle;

      if (handle === 'rotate') {
        this.rotatable = true;
      } else {
        this.resizable = true;
      }

      this.preMouseX = e.pageX || e.clientX + doc$1.scrollLeft;
      this.preMouseY = e.pageY || e.clientY + doc$1.scrollTop;
    },

    /**
     * 鼠标在页面上的坐标
     */
    handleMove: function handleMove(e) {
      this.mouseX = e.pageX || e.clientX + doc$1.scrollLeft;
      this.mouseY = e.pageY || e.clientY + doc$1.scrollTop; // x, y, w, h

      var elmX = parseInt(this.x, 10);
      var elmY = parseInt(this.y, 10);
      var elmW = parseInt(this.w, 10);
      var elmH = parseInt(this.h, 10); // diffX =  当前鼠标位置 - 上次鼠标位置 + ？？

      var diffX = (this.mouseX - this.lastMouseX + this.mouseOffX) / this.zoom;
      var diffY = (this.mouseY - this.lastMouseY + this.mouseOffY) / this.zoom;
      this.mouseOffX = 0;
      this.mouseOffY = 0;
      this.lastMouseX = this.mouseX;
      this.lastMouseY = this.mouseY;

      if (this.resizable) {
        if (this.handle.includes('top')) {
          if (elmH - diffY < this.minh) {
            // 向下移动
            // 变换后的高度小于最小高度，diffY -> 0 , this.mouseOffY为this.y -> 当前鼠标位置的距离（正数）
            this.mouseOffY = diffY - (diffY = elmH - this.minh);
          } else if (this.parent && elmY + diffY < 0) {
            // 向上移动 
            // 变换后this.y 超出父层顶部边界时， diffY -> 0, this.mouseOffY为this.y -> 当前鼠标位置的距离(负数)
            this.mouseOffY = diffY - (diffY = -elmY);
          }

          elmY += diffY;
          elmH -= diffY;
        }

        if (this.handle.includes('bottom')) {
          if (elmH + diffY < this.minh) {
            // 向上移动
            this.mouseOffY = diffY - (diffY = this.minh - elmH);
          } else if (elmY + elmH + diffY > this.parentH) {
            // 向下移动
            this.mouseOffY = diffY - (diffY = this.parentH - elmY - elmH);
          }

          elmH += diffY;
        }

        if (this.handle.includes('left')) {
          if (elmW - diffX < this.minw) {
            // 向右移动
            this.mouseOffX = diffX - (diffX = elmW - this.minw);
          } else if (this.parent && elmX + diffX < 0) {
            // 向左移动
            this.mouseOffX = diffX - (diffX = -elmX);
          }

          elmX += diffX;
          elmW -= diffX;
        }

        if (this.handle.includes('right')) {
          if (elmW + diffX < this.minw) {
            // 向左移动
            this.mouseOffX = diffX - (diffX = this.minw - elmW);
          } else if (elmX + elmW + diffX > this.parentW) {
            // 向右移动
            this.mouseOffX = diffX - (diffX = this.parentW - elmX - elmW);
          }

          elmW += diffX;
        }

        !this.disable && this.sync({
          x: Math.round(elmX / this.grid[0]) * this.grid[0],
          y: Math.round(elmY / this.grid[1]) * this.grid[1],
          w: Math.round(elmW / this.grid[0]) * this.grid[0],
          h: Math.round(elmH / this.grid[1]) * this.grid[1]
        });
        this.$emit('resizing');
      } else if (this.rotatable) {
        var angle = this.getAngle([this.parentX + this.x + this.w / 2, -(this.parentY + this.y + this.h / 2)], [this.lastMouseX, -this.lastMouseY]);
        var criticalAngle = angleArr.find(function (item) {
          return Math.abs(item - angle) < 3;
        });
        angle = typeof criticalAngle === 'number' ? criticalAngle : angle;
        !this.disable && this.sync({
          r: angle === 360 ? 0 : angle
        });
        this.$emit('rotating');
      } else if (this.draggable) {
        if (this.parent) {
          if (elmX + diffX < 0) {
            this.mouseOffX = diffX * this.zoom - (diffX = -elmX);
          } else if (elmX + elmW + diffX > this.parentW) {
            this.mouseOffX = diffX * this.zoom - (diffX = this.parentW - elmX - elmW);
          }

          if (elmY + diffY < 0) {
            this.mouseOffY = diffY * this.zoom - (diffY = -elmY);
          } else if (elmY + elmH + diffY > this.parentH) {
            this.mouseOffY = diffY * this.zoom - (diffY = this.parentH - elmY - elmH);
          }
        }

        elmX += diffX;
        elmY += diffY;
        !this.disable && this.sync({
          x: Math.round(elmX / this.grid[0]) * this.grid[0],
          y: Math.round(elmY / this.grid[1]) * this.grid[1]
        });
        this.$emit('dragging');
      } // 正在改变


      !this.changing && (this.rotatable || this.draggable || this.resizable) && (this.changing = true);
    },
    getAngle: function getAngle(center, last) {
      var diffX = last[0] - center[0];
      var diffY = last[1] - center[1];
      /**
       * https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2
       * -180 <= c < 180
       */

      var c = 360 * Math.atan2(diffY, diffX) / (2 * Math.PI);
      c = c > 90 ? 450 - c : // 第4
      90 - c; // 第1，2，3象限

      return Math.floor(c);
    },
    getRestrain: function getRestrain(num) {
      var restrain = this.restrain;
      return (num / restrain).toFixed(0) * restrain;
    },
    handleUp: function handleUp(e) {
      this.changing = false;
      this.handle = null; // 约束

      var restrain = this.restrain;

      if (restrain && restrain > 0) {
        this.sync({
          x: this.getRestrain(this.x),
          y: this.getRestrain(this.y),
          w: this.getRestrain(this.w),
          h: this.getRestrain(this.h)
        });
      }

      if (this.rotatable) {
        this.rotatable = false;
        this.$emit('rotate-end');
      }

      if (this.resizable) {
        this.resizable = false;
        this.$emit('resize-end');
      }

      if (this.draggable) {
        this.draggable = false;
        this.$emit('drag-end');
      }

      if (this.beforeStatus) {
        this.$emit('end', this.beforeStatus);
        this.beforeStatus = null;
      }
    }
  }
};

function normalizeComponent(template, style, script, scopeId, isFunctionalTemplate, moduleIdentifier
/* server only */
, shadowMode, createInjector, createInjectorSSR, createInjectorShadow) {
  if (typeof shadowMode !== 'boolean') {
    createInjectorSSR = createInjector;
    createInjector = shadowMode;
    shadowMode = false;
  } // Vue.extend constructor export interop.


  var options = typeof script === 'function' ? script.options : script; // render functions

  if (template && template.render) {
    options.render = template.render;
    options.staticRenderFns = template.staticRenderFns;
    options._compiled = true; // functional template

    if (isFunctionalTemplate) {
      options.functional = true;
    }
  } // scopedId


  if (scopeId) {
    options._scopeId = scopeId;
  }

  var hook;

  if (moduleIdentifier) {
    // server build
    hook = function hook(context) {
      // 2.3 injection
      context = context || // cached call
      this.$vnode && this.$vnode.ssrContext || // stateful
      this.parent && this.parent.$vnode && this.parent.$vnode.ssrContext; // functional
      // 2.2 with runInNewContext: true

      if (!context && typeof __VUE_SSR_CONTEXT__ !== 'undefined') {
        context = __VUE_SSR_CONTEXT__;
      } // inject component styles


      if (style) {
        style.call(this, createInjectorSSR(context));
      } // register component module identifier for async chunk inference


      if (context && context._registeredComponents) {
        context._registeredComponents.add(moduleIdentifier);
      }
    }; // used by ssr in case component is cached and beforeCreate
    // never gets called


    options._ssrRegister = hook;
  } else if (style) {
    hook = shadowMode ? function () {
      style.call(this, createInjectorShadow(this.$root.$options.shadowRoot));
    } : function (context) {
      style.call(this, createInjector(context));
    };
  }

  if (hook) {
    if (options.functional) {
      // register for functional component in vue file
      var originalRender = options.render;

      options.render = function renderWithStyleInjection(h, context) {
        hook.call(context);
        return originalRender(h, context);
      };
    } else {
      // inject component registration as beforeCreate hook
      var existing = options.beforeCreate;
      options.beforeCreate = existing ? [].concat(existing, hook) : [hook];
    }
  }

  return script;
}

var normalizeComponent_1 = normalizeComponent;

var isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());
function createInjector(context) {
  return function (id, style) {
    return addStyle(id, style);
  };
}
var HEAD = document.head || document.getElementsByTagName('head')[0];
var styles = {};

function addStyle(id, css) {
  var group = isOldIE ? css.media || 'default' : id;
  var style = styles[group] || (styles[group] = {
    ids: new Set(),
    styles: []
  });

  if (!style.ids.has(id)) {
    style.ids.add(id);
    var code = css.source;

    if (css.map) {
      // https://developer.chrome.com/devtools/docs/javascript-debugging
      // this makes source maps inside style tags work properly in Chrome
      code += '\n/*# sourceURL=' + css.map.sources[0] + ' */'; // http://stackoverflow.com/a/26603875

      code += '\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(css.map)))) + ' */';
    }

    if (!style.element) {
      style.element = document.createElement('style');
      style.element.type = 'text/css';
      if (css.media) { style.element.setAttribute('media', css.media); }
      HEAD.appendChild(style.element);
    }

    if ('styleSheet' in style.element) {
      style.styles.push(code);
      style.element.styleSheet.cssText = style.styles.filter(Boolean).join('\n');
    } else {
      var index = style.ids.size - 1;
      var textNode = document.createTextNode(code);
      var nodes = style.element.childNodes;
      if (nodes[index]) { style.element.removeChild(nodes[index]); }
      if (nodes.length) { style.element.insertBefore(textNode, nodes[index]); }else { style.element.appendChild(textNode); }
    }
  }
}

var browser = createInjector;

/* script */
var __vue_script__ = script;

/* template */
var __vue_render__ = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c(
    "div",
    {
      staticClass: "vm-draggable",
      style: _vm.coord,
      on: {
        mousedown: function($event) {
          $event.stopPropagation();
          return _vm.handleContainerDown($event)
        }
      }
    },
    [
      _c(
        "div",
        { class: { "events-none": _vm.changing }, style: _vm.style },
        [_vm._t("default")],
        2
      ),
      _vm._v(" "),
      _vm.active && _vm.handles && _vm.handles.length !== 0
        ? _c(
            "div",
            {
              class: { disable: _vm.disable, active: _vm.active },
              style: _vm.style
            },
            [
              _vm._l(_vm.handles, function(item) {
                return [
                  !_vm.disable
                    ? _c("div", {
                        key: item,
                        staticClass: "handle",
                        class: "handle-" + item,
                        on: {
                          mousedown: function($event) {
                            if (
                              !$event.type.indexOf("key") &&
                              _vm._k($event.keyCode, "left", 37, $event.key, [
                                "Left",
                                "ArrowLeft"
                              ])
                            ) {
                              return null
                            }
                            if ("button" in $event && $event.button !== 0) {
                              return null
                            }
                            $event.stopPropagation();
                            return _vm.handleDown($event, item)
                          }
                        }
                      })
                    : _vm._e()
                ]
              }),
              _vm._v(" "),
              _vm.rotatable
                ? _c("div", {
                    class: { "rotate-base-line": _vm.rotatable },
                    style: { width: _vm.width }
                  })
                : _vm._e()
            ],
            2
          )
        : _vm._e(),
      _vm._v(" "),
      _vm.rotatable
        ? [
            _c("div", {
              class: { "rotate-deg-0": _vm.rotatable },
              style: { width: _vm.width }
            }),
            _vm._v(" "),
            _c("div", {
              class: { "rotate-deg-45": _vm.rotatable },
              style: { width: _vm.width }
            }),
            _vm._v(" "),
            _c("div", {
              class: { "rotate-deg-90": _vm.rotatable },
              style: { width: _vm.width }
            }),
            _vm._v(" "),
            _c("div", {
              class: { "rotate-deg-135": _vm.rotatable },
              style: { width: _vm.width }
            }),
            _vm._v(" "),
            _c("div", { class: { "rotate-tip": _vm.rotatable } }, [
              _vm._v(_vm._s(_vm.r) + " °")
            ])
          ]
        : _vm._e()
    ],
    2
  )
};
var __vue_staticRenderFns__ = [];
__vue_render__._withStripped = true;

  /* style */
  var __vue_inject_styles__ = function (inject) {
    if (!inject) { return }
    inject("data-v-86d126aa_0", { source: "@charset \"UTF-8\";\n.vm-draggable[data-v-86d126aa] {\n  padding: 0;\n  position: absolute;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.vm-draggable[data-v-86d126aa]:hover {\n    cursor: move;\n}\n.vm-draggable .events-none[data-v-86d126aa] {\n    pointer-events: none;\n}\n.vm-draggable .active[data-v-86d126aa] {\n    padding: 0;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    position: absolute;\n    z-index: 2;\n    border: 1px dotted #108ee9;\n}\n.vm-draggable .active .handle[data-v-86d126aa] {\n      display: block;\n}\n.vm-draggable .disable[data-v-86d126aa] {\n    border: 1px dotted #e96101;\n}\n.vm-draggable .disable .handle-rotate[data-v-86d126aa]:after {\n      background: #e96101;\n}\n.vm-draggable .disable .handle-rotate[data-v-86d126aa]:before {\n      color: #e96101;\n}\n.vm-draggable .delete[data-v-86d126aa] {\n    background: #108ee9;\n    position: absolute;\n    right: 0;\n    width: 20px;\n    color: white;\n    text-align: center;\n    z-index: 300;\n}\n.handle[data-v-86d126aa] {\n  display: none;\n  position: absolute;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  z-index: 999;\n}\n.handle-left[data-v-86d126aa] {\n  top: 0;\n  left: -5px;\n  cursor: ew-resize;\n  position: absolute;\n  height: 100%;\n  width: 5px;\n}\n.handle-left[data-v-86d126aa]:hover {\n    background: -webkit-gradient(linear, left top, right top, from(rgba(255, 255, 255, 0)), to(#3F51B5));\n    background: linear-gradient(to right, rgba(255, 255, 255, 0), #3F51B5);\n}\n.handle-right[data-v-86d126aa] {\n  top: 0;\n  right: -5px;\n  cursor: ew-resize;\n  position: absolute;\n  height: 100%;\n  width: 5px;\n}\n.handle-right[data-v-86d126aa]:hover {\n    background: -webkit-gradient(linear, right top, left top, from(rgba(255, 255, 255, 0)), to(#3F51B5));\n    background: linear-gradient(to left, rgba(255, 255, 255, 0), #3F51B5);\n}\n.handle-top[data-v-86d126aa] {\n  position: absolute;\n  width: 100%;\n  height: 5px;\n  top: -5px;\n  left: 0;\n  cursor: ns-resize;\n}\n.handle-top[data-v-86d126aa]:hover {\n    background: -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(#3F51B5));\n    background: linear-gradient(to bottom, rgba(255, 255, 255, 0), #3F51B5);\n}\n.handle-bottom[data-v-86d126aa] {\n  position: absolute;\n  width: 100%;\n  height: 5px;\n  bottom: -5px;\n  left: 0;\n  cursor: ns-resize;\n}\n.handle-bottom[data-v-86d126aa]:hover {\n    background: -webkit-gradient(linear, left bottom, left top, from(rgba(255, 255, 255, 0)), to(#3F51B5));\n    background: linear-gradient(to top, rgba(255, 255, 255, 0), #3F51B5);\n}\n.handle-top-left[data-v-86d126aa] {\n  top: 0;\n  left: 0;\n  cursor: nwse-resize;\n  padding: 5px;\n}\n.handle-bottom-left[data-v-86d126aa] {\n  bottom: 0;\n  left: 0;\n  cursor: nesw-resize;\n  padding: 5px;\n}\n.handle-top-right[data-v-86d126aa] {\n  top: 0;\n  right: 0;\n  cursor: nesw-resize;\n  padding: 5px;\n}\n.handle-bottom-right[data-v-86d126aa] {\n  bottom: 0;\n  right: 0;\n  cursor: nwse-resize;\n  padding: 5px;\n}\n.handle-rotate[data-v-86d126aa] {\n  top: 0;\n  left: 50%;\n  -webkit-transform: translate(-50%, -100%);\n          transform: translate(-50%, -100%);\n  cursor: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" style=\"font-size: 20px;\"><text y=\"15\">↻</text></svg>') 10 10, default;\n  display: -webkit-box !important;\n  display: -ms-flexbox !important;\n  display: flex !important;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.handle-rotate[data-v-86d126aa]:after {\n    content: ' ';\n    height: 10px;\n    width: 1px;\n    background: #108ee9;\n}\n.handle-rotate[data-v-86d126aa]:before {\n    content: '☐';\n    -webkit-transform: translateY(26%);\n            transform: translateY(26%);\n    color: #108ee9;\n}\n\n/**\n * rotate\n */\n.rotate-base-line[data-v-86d126aa] {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  z-index: 2;\n  width: 500px;\n  border: 1px solid #1fb6ff;\n  background-color: #1fb6ff;\n  -webkit-transform: translate(-50%, -50%) rotate(90deg);\n          transform: translate(-50%, -50%) rotate(90deg);\n}\ndiv[class^=rotate-deg-][data-v-86d126aa] {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 2;\n  width: 500px;\n  border-top: 1px dashed #fff;\n  border-bottom: 1px dashed #262626;\n  opacity: .4;\n}\n.rotate-deg-0[data-v-86d126aa] {\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n.rotate-deg-45[data-v-86d126aa] {\n  -webkit-transform: translate(-50%, -50%) rotate(45deg);\n          transform: translate(-50%, -50%) rotate(45deg);\n}\n.rotate-deg-90[data-v-86d126aa] {\n  -webkit-transform: translate(-50%, -50%) rotate(90deg);\n          transform: translate(-50%, -50%) rotate(90deg);\n}\n.rotate-deg-135[data-v-86d126aa] {\n  -webkit-transform: translate(-50%, -50%) rotate(135deg);\n          transform: translate(-50%, -50%) rotate(135deg);\n}\n.rotate-tip[data-v-86d126aa] {\n  position: absolute;\n  top: -50px;\n  left: 60%;\n  width: 40px;\n  height: 16px;\n  line-height: 16px;\n  text-align: center;\n  border: 1px solid #262626;\n  border-radius: 8px;\n  background-color: #fff;\n}\n\n/*# sourceMappingURL=draggable.vue.map */", map: {"version":3,"sources":["draggable.vue","/Users/deot/Desktop/wya/github/wya-vm/src/core/draggable.vue"],"names":[],"mappings":"AAAA,gBAAgB;AC6ehB;EACA,UAAA;EACA,kBAAA;EACA,8BAAA;UAAA,sBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAAA;AAJA;IAMA,YAAA;AAAA;AANA;IASA,oBAAA;AAAA;AATA;IAYA,UAAA;IACA,MAAA;IACA,OAAA;IACA,QAAA;IACA,SAAA;IACA,kBAAA;IACA,UAAA;IACA,0BAAA;AAAA;AAnBA;MAsBA,cAAA;AAAA;AAtBA;IA0BA,0BAAA;AAAA;AA1BA;MA6BA,mBAAA;AAAA;AA7BA;MAgCA,cAAA;AAAA;AAhCA;IAqCA,mBAAA;IACA,kBAAA;IACA,QAAA;IACA,WAAA;IACA,YAAA;IACA,kBAAA;IACA,YACA;AAAA;AAGA;EACA,aAAA;EACA,kBAAA;EACA,8BAAA;UAAA,sBAAA;EACA,YAAA;AAAA;AAEA;EACA,MAAA;EACA,UAAA;EACA,iBAAA;EACA,kBAAA;EACA,YAAA;EACA,UAAA;AAAA;AANA;IAQA,oGAAA;IAAA,sEAAA;AAAA;AAGA;EACA,MAAA;EACA,WAAA;EACA,iBAAA;EACA,kBAAA;EACA,YAAA;EACA,UAAA;AAAA;AANA;IAQA,oGAAA;IAAA,qEAAA;AAAA;AAIA;EACA,kBAAA;EACA,WAAA;EACA,WAAA;EACA,SAAA;EACA,OAAA;EACA,iBAAA;AAAA;AANA;IAQA,sGAAA;IAAA,uEAAA;AAAA;AAGA;EACA,kBAAA;EACA,WAAA;EACA,WAAA;EACA,YAAA;EACA,OAAA;EACA,iBAAA;AAAA;AANA;IAQA,sGAAA;IAAA,oEAAA;AAAA;AAGA;EACA,MAAA;EACA,OAAA;EACA,mBAAA;EACA,YAAA;AAAA;AAEA;EACA,SAAA;EACA,OAAA;EACA,mBAAA;EACA,YAAA;AAAA;AAEA;EACA,MAAA;EACA,QAAA;EACA,mBAAA;EACA,YAAA;AAAA;AAEA;EACA,SAAA;EACA,QAAA;EACA,mBAAA;EACA,YAAA;AAAA;AAEA;EACA,MAAA;EACA,SAAA;EACA,yCAAA;UAAA,iCAAA;EACA,yKAEA;EACA,+BAAA;EAAA,+BAAA;EAAA,wBAAA;EACA,4BAAA;EAAA,6BAAA;MAAA,0BAAA;UAAA,sBAAA;EACA,yBAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,wBAAA;MAAA,qBAAA;UAAA,uBAAA;AAAA;AAVA;IAYA,YAAA;IACA,YAAA;IACA,UAAA;IACA,mBAAA;AAAA;AAfA;IAkBA,YAAA;IACA,kCAAA;YAAA,0BAAA;IACA,cAAA;AAAA;;AAGA;;ED/fE;ACkgBF;EACA,kBAAA;EACA,SAAA;EACA,QAAA;EACA,UAAA;EACA,YAAA;EACA,yBAAA;EACA,yBAAA;EACA,sDAAA;UAAA,8CAAA;AAAA;AAEA;EACA,kBAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,YAAA;EACA,2BAAA;EACA,iCAAA;EACA,WAAA;AAAA;AAEA;EACA,wCAAA;UAAA,gCAAA;AAAA;AAEA;EACA,sDAAA;UAAA,8CAAA;AAAA;AAEA;EACA,sDAAA;UAAA,8CAAA;AAAA;AAEA;EACA,uDAAA;UAAA,+CAAA;AAAA;AAEA;EACA,kBAAA;EACA,UAAA;EACA,SAAA;EACA,WAAA;EACA,YAAA;EACA,iBAAA;EACA,kBAAA;EACA,yBAAA;EACA,kBAAA;EACA,sBAAA;AAAA;;AD/fA,wCAAwC","file":"draggable.vue","sourcesContent":["@charset \"UTF-8\";\n.vm-draggable {\n  padding: 0;\n  position: absolute;\n  box-sizing: border-box;\n  user-select: none; }\n  .vm-draggable:hover {\n    cursor: move; }\n  .vm-draggable .events-none {\n    pointer-events: none; }\n  .vm-draggable .active {\n    padding: 0;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    position: absolute;\n    z-index: 2;\n    border: 1px dotted #108ee9; }\n    .vm-draggable .active .handle {\n      display: block; }\n  .vm-draggable .disable {\n    border: 1px dotted #e96101; }\n    .vm-draggable .disable .handle-rotate:after {\n      background: #e96101; }\n    .vm-draggable .disable .handle-rotate:before {\n      color: #e96101; }\n  .vm-draggable .delete {\n    background: #108ee9;\n    position: absolute;\n    right: 0;\n    width: 20px;\n    color: white;\n    text-align: center;\n    z-index: 300; }\n\n.handle {\n  display: none;\n  position: absolute;\n  box-sizing: border-box;\n  z-index: 999; }\n\n.handle-left {\n  top: 0;\n  left: -5px;\n  cursor: ew-resize;\n  position: absolute;\n  height: 100%;\n  width: 5px; }\n  .handle-left:hover {\n    background: linear-gradient(to right, rgba(255, 255, 255, 0), #3F51B5); }\n\n.handle-right {\n  top: 0;\n  right: -5px;\n  cursor: ew-resize;\n  position: absolute;\n  height: 100%;\n  width: 5px; }\n  .handle-right:hover {\n    background: linear-gradient(to left, rgba(255, 255, 255, 0), #3F51B5); }\n\n.handle-top {\n  position: absolute;\n  width: 100%;\n  height: 5px;\n  top: -5px;\n  left: 0;\n  cursor: ns-resize; }\n  .handle-top:hover {\n    background: linear-gradient(to bottom, rgba(255, 255, 255, 0), #3F51B5); }\n\n.handle-bottom {\n  position: absolute;\n  width: 100%;\n  height: 5px;\n  bottom: -5px;\n  left: 0;\n  cursor: ns-resize; }\n  .handle-bottom:hover {\n    background: linear-gradient(to top, rgba(255, 255, 255, 0), #3F51B5); }\n\n.handle-top-left {\n  top: 0;\n  left: 0;\n  cursor: nwse-resize;\n  padding: 5px; }\n\n.handle-bottom-left {\n  bottom: 0;\n  left: 0;\n  cursor: nesw-resize;\n  padding: 5px; }\n\n.handle-top-right {\n  top: 0;\n  right: 0;\n  cursor: nesw-resize;\n  padding: 5px; }\n\n.handle-bottom-right {\n  bottom: 0;\n  right: 0;\n  cursor: nwse-resize;\n  padding: 5px; }\n\n.handle-rotate {\n  top: 0;\n  left: 50%;\n  transform: translate(-50%, -100%);\n  cursor: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" style=\"font-size: 20px;\"><text y=\"15\">↻</text></svg>') 10 10, default;\n  display: flex !important;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center; }\n  .handle-rotate:after {\n    content: ' ';\n    height: 10px;\n    width: 1px;\n    background: #108ee9; }\n  .handle-rotate:before {\n    content: '☐';\n    transform: translateY(26%);\n    color: #108ee9; }\n\n/**\n * rotate\n */\n.rotate-base-line {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  z-index: 2;\n  width: 500px;\n  border: 1px solid #1fb6ff;\n  background-color: #1fb6ff;\n  transform: translate(-50%, -50%) rotate(90deg); }\n\ndiv[class^=rotate-deg-] {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 2;\n  width: 500px;\n  border-top: 1px dashed #fff;\n  border-bottom: 1px dashed #262626;\n  opacity: .4; }\n\n.rotate-deg-0 {\n  transform: translate(-50%, -50%); }\n\n.rotate-deg-45 {\n  transform: translate(-50%, -50%) rotate(45deg); }\n\n.rotate-deg-90 {\n  transform: translate(-50%, -50%) rotate(90deg); }\n\n.rotate-deg-135 {\n  transform: translate(-50%, -50%) rotate(135deg); }\n\n.rotate-tip {\n  position: absolute;\n  top: -50px;\n  left: 60%;\n  width: 40px;\n  height: 16px;\n  line-height: 16px;\n  text-align: center;\n  border: 1px solid #262626;\n  border-radius: 8px;\n  background-color: #fff; }\n\n/*# sourceMappingURL=draggable.vue.map */","<template>\n\t<div :style=\"coord\" class=\"vm-draggable\" @mousedown.stop=\"handleContainerDown\">\n\t\t<div :style=\"style\" :class=\"{ 'events-none': changing }\" >\n\t\t\t<slot :style=\"style\"/>\n\t\t</div>\n\t\t<!-- handle -->\n\t\t<div \n\t\t\tv-if=\"active && handles && handles.length !== 0\" \n\t\t\t:class=\"{ disable, active }\" \n\t\t\t:style=\"style\"\n\t\t>\n\t\t\t<template v-for=\"item in handles\">\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"!disable\"\n\t\t\t\t\t:key=\"item\"\n\t\t\t\t\t:class=\"`handle-${item}`\"\n\t\t\t\t\tclass=\"handle\"\n\t\t\t\t\t@mousedown.left.stop=\"handleDown($event, item)\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<div v-if=\"rotatable\" :class=\"{ 'rotate-base-line': rotatable }\" :style=\"{ width }\" />\n\t\t</div>\n\t\t<!-- grid for rotate -->\n\t\t<template v-if=\"rotatable\">\n\t\t\t<div :class=\"{ 'rotate-deg-0': rotatable }\" :style=\"{ width }\" />\n\t\t\t<div :class=\"{ 'rotate-deg-45': rotatable }\" :style=\"{ width }\" />\n\t\t\t<div :class=\"{ 'rotate-deg-90': rotatable }\" :style=\"{ width }\" />\n\t\t\t<div :class=\"{ 'rotate-deg-135': rotatable }\" :style=\"{ width }\" />\n\t\t\t<div :class=\"{ 'rotate-tip': rotatable }\">{{ r }} °</div>\n\t\t</template>\n\t</div>\n</template>\n\n<script>\nimport { isPassiveSupported, eleInRegExp } from '../utils/helper';\n\nconst doc = document.documentElement;\nconst angleArr = [0, 45, 90, 135, 180, 225, 270, 315, 360];\n\nexport default {\n\treplace: true,\n\tname: 'vm-draggable',\n\tprops: {\n\t\tdisable: {\n\t\t\ttype: Boolean, \n\t\t\tdefault: false\n\t\t},\n\t\thandles: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => (['top', 'right', 'bottom', 'left', 'top-left', 'top-right', 'bottom-right', 'bottom-left', 'rotate'])\n\t\t},\n\t\t// 宽度\n\t\tw: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t\tvalidator: val => val >= 0\n\t\t},\n\t\t// 高度\n\t\th: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t\tvalidator: val => val >= 0\n\t\t},\n\t\t// 选择角度\n\t\tr: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\t// 最小宽度\n\t\tminw: {\n\t\t\ttype: Number,\n\t\t\tdefault: 36,\n\t\t\tvalidator: val => val > 0\n\t\t},\n\t\t// 最小高度\n\t\tminh: {\n\t\t\ttype: Number,\n\t\t\tdefault: 36,\n\t\t\tvalidator: val => val > 0\n\t\t},\n\t\t// 距父元素左上角X轴偏移量\n\t\tx: { \n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\t// 距父元素左上角Y轴偏移量\n\t\ty: { \n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\t// zIndex\n\t\tz: { \n\t\t\ttype: Number,\n\t\t\tdefault: 1\n\t\t},\n\t\tzoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1\n\t\t},\n\t\tgrid: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => {\n\t\t\t\treturn [1, 1];\n\t\t\t}\n\t\t},\n\t\t// 约束组件大小\n\t\trestrain: {\n\t\t\ttype: Number, \n\t\t\tdefault: 0\n\t\t},\n\t\tparent: {\n\t\t\ttype: Boolean, \n\t\t\tdefault: false\n\t\t},\n\t\teditorRegExp: {\n\t\t\ttype: Object, \n\t\t\tdefault: () => ({\n\t\t\t\tclassName: /vm-hack-editor/\n\t\t\t})\n\t\t},\n\t\t/**\n\t\t * 是否屏蔽默认事件\n\t\t */\n\t\tprevent: {\n\t\t\ttype: Boolean, \n\t\t\tdefault: true\n\t\t},\n\t\tpreventRegExp: {\n\t\t\ttype: Object, \n\t\t\tdefault: () => ({\n\t\t\t\ttagName: /^(INPUT|TEXTAREA|BUTTON|SELECT|OPTION)$/,\n\t\t\t\tclassName: /vm-hack-pevent/\n\t\t\t})\n\t\t},\n\t},\n\tdata() {\n\n\t\treturn {\n\t\t\tresizable: false,\n\t\t\tdraggable: false,\n\t\t\trotatable: false,\n\t\t\tchanging: false,\n\t\t\tactive: false\n\t\t};\n\t},\n\tcomputed: {\n\t\tcoord() {\n\t\t\treturn {\n\t\t\t\tleft: this.x + 'px',\n\t\t\t\ttop: this.y + 'px',\n\t\t\t\tzIndex: this.z\n\t\t\t};\n\t\t},\n\t\tstyle() {\n\t\t\tconst w = this.w === 0 ? 'auto' : `${this.w}px`;\n\t\t\tconst h = this.h === 0 ? 'auto' : `${this.h}px`;\n\t\t\treturn {\n\t\t\t\twidth: w,\n\t\t\t\theight: h,\n\t\t\t\ttransform: `rotate(${this.r}deg)`\n\t\t\t};\n\t\t},\n\t\twidth() {\n\t\t\tlet num = Math.floor(\n\t\t\t\tMath.sqrt(this.w * this.w + this.h * this.h) * 1.15\n\t\t\t);\n\t\t\treturn `${num}px`;\n\t\t}\n\t},\n\twatch: {},\n\tbeforeCreate() {\n\t\tthis.parentX = 0;\n\t\tthis.parentY = 0;\n\t\tthis.parentW = 9999;\n\t\tthis.parentH = 9999;\n\t\tthis.mouseX = 0;\n\t\tthis.mouseY = 0;\n\t\tthis.lastMouseX = 0;\n\t\tthis.lastMouseY = 0;\n\t\tthis.mouseOffX = 0;\n\t\tthis.mouseOffY = 0;\n\n\t\tthis.handle = null;\n\n\t\t// 组件捕获阶段执行\n\t\tthis.eventOpts = !isPassiveSupported || { capture: true, passive: true };\n\n\t\t// 改变前状态\n\t\tthis.beforeStatus = null;\n\t},\n\tmounted() {\n\t\t// 初始化控件宽高, todo: 宽高未零时，是否需要计算\n\t\tif (this.w && this.minw > this.w) {\n\t\t\tthis.sync({ w: this.minw });\n\t\t}\n\t\tif (this.h && this.minh > this.h) {\n\t\t\tthis.sync({ h: this.minh });\n\t\t}\n\t\tconst { x, y } = this.$el.parentNode.getBoundingClientRect();\n\t\tthis.parentX = x;\n\t\tthis.parentY = y;\n\n\t\t// 判断是否只能在父级元素中拖动\n\t\tthis.parent && this.calculation();\n\t\tthis.$emit('resizing');\n\t},\n\tdestroyed() {\n\t\tthis.operateDOMEvents('remove');\n\t},\n\tmethods: {\n\t\tcalculation() {\n\t\t\tconst { width, height } = this.$el.parentNode.getBoundingClientRect();\n\t\t\tthis.parentW = width;\n\t\t\tthis.parentH = height; // this.$el.parentNode.clientHeight\n\t\t\tif (this.w > this.parentW) {\n\t\t\t\tthis.sync({ w: this.parentW });\n\t\t\t}\n\t\t\tif (this.h > this.parentH) {\n\t\t\t\tthis.sync({ h: this.parentH });\n\t\t\t}\n\t\t\tif ((this.x + this.w) > this.parentW) {\n\t\t\t\tthis.sync({ x: this.parentW - this.w });\n\t\t\t}\n\t\t\tif ((this.y + this.h) > this.parentH) {\n\t\t\t\tthis.sync({ y: this.parentH - this.h });\n\t\t\t}\n\t\t},\n\t\tsync(opts) {\t\t\t\n\t\t\tfor (let key in opts) {\n\t\t\t\tif (this[key] != opts[key]) {\n\t\t\t\t\t!this.beforeStatus && (this.beforeStatus = {\n\t\t\t\t\t\tx: this.x,\n\t\t\t\t\t\ty: this.y,\n\t\t\t\t\t\tz: this.z,\n\t\t\t\t\t\tw: this.w,\n\t\t\t\t\t\tr: this.r\n\t\t\t\t\t});\n\t\t\t\t\tthis.$emit(`update:${key}`, opts[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\toperateDOMEvents(type) {\n\t\t\tlet fn = type === 'add' ? doc.addEventListener : doc.removeEventListener;\n\n\t\t\tfn('mousedown', this.handleDeselect, this.eventOpts);\n\t\t\tfn('mousemove', this.handleMove, this.eventOpts);\n\t\t\tfn('mouseup', this.handleUp, this.eventOpts);\n\t\t},\n\t\t/**\n\t\t * 模拟设置active状态\n\t\t */\n\t\tsetActived() {\n\t\t\tthis.handleContainerDown();\n\t\t\tthis.handleUp();\n\t\t},\n\t\t/**\n\t\t * 组件被按下事件\n\t\t */\n\t\thandleContainerDown(e = {}) {\n\t\t\t// 去除默认事件 todo: 匹配输入框\n\t\t\tthis.prevent\n\t\t\t\t&& e.preventDefault \n\t\t\t\t&& !eleInRegExp(e.target, this.preventRegExp)\n\t\t\t\t&& e.preventDefault();\n\n\t\t\t// 判断是否支持拖动\n\t\t\tif (this.disable) return;\n\t\t\tconst target = e.target || e.srcElement;\n\t\t\t// 确保事件发生在组件内部\n\t\t\tif (!target || this.$el.contains(target)) {\n\t\t\t\tif (!this.active) {\n\t\t\t\t\tthis.lastMouseX = e.pageX || e.clientX + doc.scrollLeft;\n\t\t\t\t\tthis.lastMouseY = e.pageY || e.clientY + doc.scrollTop;\n\n\t\t\t\t\t// 绑定事件\n\t\t\t\t\tthis.operateDOMEvents('add');\n\n\t\t\t\t\tthis.active = true;\n\t\t\t\t\tthis.$emit('activated');\n\t\t\t\t}\n\t\t\t\tthis.draggable = true;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * 取消选择事件\n\t\t */\n\t\thandleDeselect(e) {\n\t\t\tthis.mouseX = e.pageX || e.clientX + doc.scrollLeft;\n\t\t\tthis.mouseY = e.pageY || e.clientY + doc.scrollTop;\n\t\t\tthis.lastMouseX = this.mouseX;\n\t\t\tthis.lastMouseY = this.mouseY;\n\t\t\tconst target = e.target || e.srcElement; // body不要带上class, 否则会存在问题\n\n\t\t\t// 内部管理\n\t\t\tconst regex = {\n\t\t\t\tclassName: /handle-([(top|right|-|bottom|left)]{2})/\n\t\t\t};\n\n\t\t\tlet path = e.path || (e.composedPath && e.composedPath()) || [];\n\t\t\tif (\n\t\t\t\t!this.$el.contains(target) \n\t\t\t\t&& !eleInRegExp(target, regex)\n\t\t\t\t&& (!path.some(item => eleInRegExp(item, this.editorRegExp)))\n\t\t\t) {\n\t\t\t\tif (this.active) {\n\t\t\t\t\t// 解绑\n\t\t\t\t\tthis.operateDOMEvents('remove');\n\n\t\t\t\t\tthis.active = false;\n\t\t\t\t\tthis.$emit('deactivated');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * 拖动点按下事件\n\t\t */\n\t\thandleDown(e, handle) {\n\t\t\t// 去除默认事件 todo: 匹配输入框\n\t\t\tthis.prevent\n\t\t\t\t&& e.preventDefault \n\t\t\t\t&& !eleInRegExp(e.target, this.preventRegExp)\n\t\t\t\t&& e.preventDefault();\n\n\t\t\t// 将handle设置为当前元素\n\t\t\tthis.handle = handle;\n\t\t\tif (handle === 'rotate') {\n\t\t\t\tthis.rotatable = true;\n\t\t\t} else {\n\t\t\t\tthis.resizable = true;\n\t\t\t}\n\n\t\t\tthis.preMouseX = e.pageX || e.clientX + doc.scrollLeft;\n\t\t\tthis.preMouseY = e.pageY || e.clientY + doc.scrollTop;\n\t\t},\n\t\t/**\n\t\t * 鼠标在页面上的坐标\n\t\t */\n\t\thandleMove(e) {\n\t\t\tthis.mouseX = e.pageX || e.clientX + doc.scrollLeft;\n\t\t\tthis.mouseY = e.pageY || e.clientY + doc.scrollTop;\n\n\t\t\t// x, y, w, h\n\t\t\tlet elmX = parseInt(this.x, 10);\n\t\t\tlet elmY = parseInt(this.y, 10);\n\t\t\tlet elmW = parseInt(this.w, 10);\n\t\t\tlet elmH = parseInt(this.h, 10);\n\n\t\t\t// diffX =  当前鼠标位置 - 上次鼠标位置 + ？？\n\t\t\tlet diffX = (this.mouseX - this.lastMouseX + this.mouseOffX) / this.zoom;\n\t\t\tlet diffY = (this.mouseY - this.lastMouseY + this.mouseOffY) / this.zoom;\n\t\t\tthis.mouseOffX = 0;\n\t\t\tthis.mouseOffY = 0;\n\t\t\tthis.lastMouseX = this.mouseX;\n\t\t\tthis.lastMouseY = this.mouseY;\n\t\t\tif (this.resizable) {\n\t\t\t\tif (this.handle.includes('top')) {\n\t\t\t\t\tif (elmH - diffY < this.minh) { // 向下移动\n\t\t\t\t\t\t// 变换后的高度小于最小高度，diffY -> 0 , this.mouseOffY为this.y -> 当前鼠标位置的距离（正数）\n\t\t\t\t\t\tthis.mouseOffY = (diffY - (diffY = elmH - this.minh));\n\t\t\t\t\t} else if (this.parent && elmY + diffY < 0) { // 向上移动 \n\t\t\t\t\t\t// 变换后this.y 超出父层顶部边界时， diffY -> 0, this.mouseOffY为this.y -> 当前鼠标位置的距离(负数)\n\t\t\t\t\t\tthis.mouseOffY = (diffY - (diffY = -elmY));\n\t\t\t\t\t}\n\t\t\t\t\telmY += diffY;\n\t\t\t\t\telmH -= diffY;\n\t\t\t\t}\n\t\t\t\tif (this.handle.includes('bottom')) {\n\t\t\t\t\tif (elmH + diffY < this.minh) { // 向上移动\n\t\t\t\t\t\tthis.mouseOffY = (diffY - (diffY = this.minh - elmH));\n\t\t\t\t\t} else if (elmY + elmH + diffY > this.parentH) { // 向下移动\n\t\t\t\t\t\tthis.mouseOffY = (diffY - (diffY = this.parentH - elmY - elmH));\n\t\t\t\t\t}\n\t\t\t\t\telmH += diffY;\n\t\t\t\t}\n\t\t\t\tif (this.handle.includes('left')) {\n\t\t\t\t\tif (elmW - diffX < this.minw) { // 向右移动\n\t\t\t\t\t\tthis.mouseOffX = (diffX - (diffX = elmW - this.minw));\n\t\t\t\t\t} else if (this.parent && elmX + diffX < 0) { // 向左移动\n\t\t\t\t\t\tthis.mouseOffX = (diffX - (diffX = -elmX));\n\t\t\t\t\t}\n\t\t\t\t\telmX += diffX;\n\t\t\t\t\telmW -= diffX;\n\t\t\t\t}\n\t\t\t\tif (this.handle.includes('right')) {\n\t\t\t\t\tif (elmW + diffX < this.minw) { // 向左移动\n\t\t\t\t\t\tthis.mouseOffX = (diffX - (diffX = this.minw - elmW));\n\t\t\t\t\t} else if (elmX + elmW + diffX > this.parentW) { // 向右移动\n\t\t\t\t\t\tthis.mouseOffX = (diffX - (diffX = this.parentW - elmX - elmW));\n\t\t\t\t\t}\n\t\t\t\t\telmW += diffX;\n\t\t\t\t}\n\t\t\t\t!this.disable && this.sync({\n\t\t\t\t\tx: (Math.round(elmX / this.grid[0]) * this.grid[0]),\n\t\t\t\t\ty: (Math.round(elmY / this.grid[1]) * this.grid[1]),\n\t\t\t\t\tw: (Math.round(elmW / this.grid[0]) * this.grid[0]),\n\t\t\t\t\th: (Math.round(elmH / this.grid[1]) * this.grid[1]),\n\t\t\t\t});\n\t\t\t\tthis.$emit('resizing');\n\t\t\t} else if (this.rotatable) {\n\t\t\t\tlet angle = this.getAngle(\n\t\t\t\t\t[this.parentX + this.x + this.w / 2, -(this.parentY + this.y + this.h / 2)],\n\t\t\t\t\t[this.lastMouseX, -this.lastMouseY],\n\t\t\t\t);\n\n\t\t\t\tlet criticalAngle = angleArr.find(item => Math.abs(item - angle) < 3);\n\t\t\t\tangle = typeof criticalAngle === 'number' ? criticalAngle : angle;\n\n\t\t\t\t!this.disable && this.sync({ \n\t\t\t\t\tr: angle === 360 ? 0 : angle\n\t\t\t\t});\n\t\t\t\tthis.$emit('rotating');\n\t\t\t} else if (this.draggable) {\n\t\t\t\tif (this.parent) {\n\t\t\t\t\tif (elmX + diffX < 0) {\n\t\t\t\t\t\tthis.mouseOffX = (diffX * this.zoom - (diffX = -elmX));\n\t\t\t\t\t} else if (elmX + elmW + diffX > this.parentW) {\n\t\t\t\t\t\tthis.mouseOffX = (diffX * this.zoom - (diffX = this.parentW - elmX - elmW));\n\t\t\t\t\t}\n\t\t\t\t\tif (elmY + diffY < 0) {\n\t\t\t\t\t\tthis.mouseOffY = (diffY * this.zoom - (diffY = -elmY));\n\t\t\t\t\t} else if (elmY + elmH + diffY > this.parentH) {\n\t\t\t\t\t\tthis.mouseOffY = (diffY * this.zoom - (diffY = this.parentH - elmY - elmH));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\telmX += diffX;\n\t\t\t\telmY += diffY;\n\n\t\t\t\t!this.disable && this.sync({\n\t\t\t\t\tx: (Math.round(elmX / this.grid[0]) * this.grid[0]),\n\t\t\t\t\ty: (Math.round(elmY / this.grid[1]) * this.grid[1]),\n\t\t\t\t});\n\t\t\t\tthis.$emit('dragging');\n\t\t\t}\n\n\t\t\t// 正在改变\n\t\t\t!this.changing \n\t\t\t\t&& (this.rotatable || this.draggable || this.resizable)\n\t\t\t\t&& (this.changing = true);\n\t\t\t\t\n\t\t},\n\t\tgetAngle(center, last) {\n\t\t\tlet diffX = last[0] - center[0];\n\t\t\tlet diffY = last[1] - center[1];\n\t\t\t/**\n\t\t\t * https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2\n\t\t\t * -180 <= c < 180\n\t\t\t */\n\t\t\tlet c = 360 * Math.atan2(diffY, diffX) / (2 * Math.PI);\n\t\t\tc = c > 90 \n\t\t\t\t? (450 - c) // 第4\n\t\t\t\t: 90 - c; // 第1，2，3象限\n\t\t\treturn Math.floor(c);\n\t\t},\n\t\tgetRestrain(num) {\n\t\t\tconst restrain = this.restrain;\n\t\t\treturn (num / restrain).toFixed(0) * restrain;\n\t\t},\n\t\thandleUp(e) {\n\t\t\tthis.changing = false;\n\t\t\tthis.handle = null;\n\t\t\t// 约束\n\t\t\tconst restrain = this.restrain;\n\t\t\tif (restrain && restrain > 0) {\n\t\t\t\tthis.sync({\n\t\t\t\t\tx: this.getRestrain(this.x),\n\t\t\t\t\ty: this.getRestrain(this.y),\n\t\t\t\t\tw: this.getRestrain(this.w),\n\t\t\t\t\th: this.getRestrain(this.h),\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (this.rotatable) {\n\t\t\t\tthis.rotatable = false;\n\t\t\t\tthis.$emit('rotate-end');\n\t\t\t}\n\t\t\tif (this.resizable) {\n\t\t\t\tthis.resizable = false;\n\t\t\t\tthis.$emit('resize-end');\n\t\t\t}\n\t\t\tif (this.draggable) {\n\t\t\t\tthis.draggable = false;\n\t\t\t\tthis.$emit('drag-end');\n\t\t\t}\n\t\t\tif (this.beforeStatus) {\n\t\t\t\tthis.$emit('end', this.beforeStatus);\n\t\t\t\tthis.beforeStatus = null;\n\t\t\t}\n\t\t}\n\t},\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.vm-draggable {\n\tpadding: 0;\n\tposition: absolute;\n\tbox-sizing: border-box;\n\tuser-select: none;\n\t&:hover {\n\t\tcursor: move;\n\t}\n\t.events-none {\n\t\tpointer-events: none;\n\t}\n\t.active {\n\t\tpadding: 0;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tposition: absolute;\n\t\tz-index: 2;\n\t\tborder: 1px dotted #108ee9;\n\t\t// cursor: move;\n\t\t.handle {\n\t\t\tdisplay: block;\n\t\t}\n\t}\n\t.disable {\n\t\tborder: 1px dotted #e96101;\n\t\t.handle-rotate {\n\t\t\t&:after {\n\t\t\t\tbackground: #e96101;\n\t\t\t}\n\t\t\t&:before {\n\t\t\t\tcolor: #e96101;\n\t\t\t}\n\t\t}\n\t}\n\t.delete {\n\t\tbackground: #108ee9;\n\t\tposition: absolute;\n\t\tright: 0;\n\t\twidth: 20px;\n\t\tcolor: white;\n\t\ttext-align: center;\n\t\tz-index: 300\n\t}\n}\n\n.handle {\n\tdisplay: none;\n\tposition: absolute;\n\tbox-sizing: border-box;\n\tz-index: 999;\n}\n.handle-left {\n\ttop: 0;\n\tleft: -5px;\n\tcursor: ew-resize;\n\tposition: absolute;\n\theight: 100%;\n\twidth: 5px;\n\t&:hover {\n\t\tbackground: linear-gradient(to right, rgba(255, 255, 255, 0), #3F51B5);\n\t}\n}\n.handle-right {\n\ttop: 0;\n\tright: -5px;\n\tcursor: ew-resize;\n\tposition: absolute;\n\theight: 100%;\n\twidth: 5px;\n\t&:hover {\n\t\tbackground: linear-gradient(to left, rgba(255, 255, 255, 0), #3F51B5);\n\t}\n}\n\n.handle-top {\n\tposition: absolute;\n\twidth: 100%;\n\theight: 5px;\n\ttop: -5px;\n\tleft: 0;\n\tcursor: ns-resize;\n\t&:hover {\n\t\tbackground: linear-gradient(to bottom, rgba(255, 255, 255, 0), #3F51B5);\n\t}\n}\n.handle-bottom {\n\tposition: absolute;\n\twidth: 100%;\n\theight: 5px;\n\tbottom: -5px;\n\tleft: 0;\n\tcursor: ns-resize;\n\t&:hover {\n\t\tbackground: linear-gradient(to top, rgba(255, 255, 255, 0), #3F51B5);\n\t}\n}\n.handle-top-left {\n\ttop: 0;\n\tleft: 0;\n\tcursor: nwse-resize;\n\tpadding: 5px;\n}\n.handle-bottom-left {\n\tbottom: 0;\n\tleft: 0;\n\tcursor: nesw-resize;\n\tpadding: 5px;\n}\n.handle-top-right {\n\ttop: 0;\n\tright: 0;\n\tcursor: nesw-resize;\n\tpadding: 5px;\n}\n.handle-bottom-right {\n\tbottom: 0;\n\tright: 0;\n\tcursor: nwse-resize;\n\tpadding: 5px;\n}\n.handle-rotate {\n\ttop: 0;\n\tleft: 50%;\n\ttransform: translate(-50%, -100%);\n\tcursor: url(\n\t\t'data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" style=\"font-size: 20px;\"><text y=\"15\">↻</text></svg>'\n\t) 10 10,default;\n\tdisplay: flex !important;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\t&:after {\n\t\tcontent: ' ';\n\t\theight: 10px;\n\t\twidth: 1px;\n\t\tbackground: #108ee9;\n\t}\n\t&:before {\n\t\tcontent: '☐';\n\t\ttransform: translateY(26%);\n\t\tcolor: #108ee9;\n\t}\n}\n/**\n * rotate\n */\n.rotate-base-line {\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tz-index: 2;\n\twidth: 500px;\n\tborder: 1px solid #1fb6ff;\n\tbackground-color: #1fb6ff;\n\ttransform: translate(-50%, -50%) rotate(90deg);\n}\ndiv[class^=rotate-deg-] {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\tz-index: 2;\n\twidth: 500px;\n\tborder-top: 1px dashed #fff;\n\tborder-bottom: 1px dashed #262626;\n\topacity: .4;\n}\n.rotate-deg-0 {\n\ttransform: translate(-50%, -50%);\n}\n.rotate-deg-45 {\n\ttransform: translate(-50%, -50%) rotate(45deg);\n}\n.rotate-deg-90 {\n\ttransform: translate(-50%, -50%) rotate(90deg);\n}\n.rotate-deg-135 {\n\ttransform: translate(-50%, -50%) rotate(135deg);\n}\n.rotate-tip {\n\tposition: absolute;\n\ttop: -50px;\n\tleft: 60%;\n\twidth: 40px;\n\theight: 16px;\n\tline-height: 16px;\n\ttext-align: center;\n\tborder: 1px solid #262626;\n\tborder-radius: 8px;\n\tbackground-color: #fff;\n}\n</style>\n"]}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__ = "data-v-86d126aa";
  /* module identifier */
  var __vue_module_identifier__ = undefined;
  /* functional template */
  var __vue_is_functional_template__ = false;
  /* style inject SSR */
  

  
  var Draggable = normalizeComponent_1(
    { render: __vue_render__, staticRenderFns: __vue_staticRenderFns__ },
    __vue_inject_styles__,
    __vue_script__,
    __vue_scope_id__,
    __vue_is_functional_template__,
    __vue_module_identifier__,
    browser,
    undefined
  );

//
//
//
//
//
//
//
//
//
//
//
//
//
var script$1 = {
  name: 'vm-tpl-viewer',
  components: {},
  props: {
    id: String,
    x: Number,
    y: Number,
    z: Number,
    w: Number,
    h: Number,
    r: Number,
    name: [Number, String]
  },
  data: function data() {
    return {};
  },
  computed: {},
  created: function created() {},
  methods: {}
};

/* script */
var __vue_script__$1 = script$1;

/* template */
var __vue_render__$1 = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c(
    "div",
    {
      style: [
        {
          height: "" + (_vm.h ? _vm.h + "px" : "auto"),
          width: "" + (_vm.w ? _vm.w + "px" : "auto"),
          color: "black"
        }
      ]
    },
    [
      _vm._v("\n\tid: " + _vm._s(_vm.id) + " "),
      _c("br"),
      _vm._v("\n\tX: " + _vm._s(_vm.x) + " "),
      _c("br"),
      _vm._v("\n\tY: " + _vm._s(_vm.y) + " "),
      _c("br"),
      _vm._v("\n\tZ: " + _vm._s(_vm.z) + " "),
      _c("br"),
      _vm._v("\n\tWidth: " + _vm._s(_vm.w ? _vm.w : "auto") + " "),
      _c("br"),
      _vm._v("\n\tHeight: " + _vm._s(_vm.h ? _vm.h : "auto") + " "),
      _c("br"),
      _vm._v("\n\tRotate: " + _vm._s(_vm.r) + " "),
      _c("br"),
      _vm._v("\n\tName: " + _vm._s(_vm.name) + " "),
      _c("br")
    ]
  )
};
var __vue_staticRenderFns__$1 = [];
__vue_render__$1._withStripped = true;

  /* style */
  var __vue_inject_styles__$1 = function (inject) {
    if (!inject) { return }
    inject("data-v-2b9bc37d_0", { source: "\n/*# sourceMappingURL=viewer.vue.map */", map: {"version":3,"sources":["viewer.vue"],"names":[],"mappings":";AACA,qCAAqC","file":"viewer.vue"}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$1 = "data-v-2b9bc37d";
  /* module identifier */
  var __vue_module_identifier__$1 = undefined;
  /* functional template */
  var __vue_is_functional_template__$1 = false;
  /* style inject SSR */
  

  
  var Viewer = normalizeComponent_1(
    { render: __vue_render__$1, staticRenderFns: __vue_staticRenderFns__$1 },
    __vue_inject_styles__$1,
    __vue_script__$1,
    __vue_scope_id__$1,
    __vue_is_functional_template__$1,
    __vue_module_identifier__$1,
    browser,
    undefined
  );

//
//
//
//
//
//
//
//
//
//
//
//
var script$2 = {
  name: 'vm-tpl-editor',
  components: {},
  props: {
    w: Number,
    h: Number,
    r: Number,
    x: Number,
    y: Number,
    z: Number,
    name: [Number, String]
  },
  data: function data() {
    return {};
  },
  computed: {},
  created: function created() {},
  methods: {
    handleChange: function handleChange(e, key) {
      this.$emit('change', _defineProperty({}, key, e.target.value));
    },
    handleClick: function handleClick() {
      // this.$emit('update:x', this.x + 1);
      this.$emit('change', {
        x: this.x + 1
      });
    }
  }
};

/* script */
var __vue_script__$2 = script$2;

/* template */
var __vue_render__$2 = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c(
    "div",
    { staticStyle: { display: "flex", "flex-direction": "column" } },
    [
      _c("div", [
        _vm._v("w: "),
        _c("input", {
          domProps: { value: _vm.w },
          on: {
            input: function($event) {
              return _vm.handleChange($event, "w")
            }
          }
        })
      ]),
      _vm._v(" "),
      _c("div", [
        _vm._v("h: "),
        _c("input", {
          domProps: { value: _vm.h },
          on: {
            input: function($event) {
              return _vm.handleChange($event, "h")
            }
          }
        })
      ]),
      _vm._v(" "),
      _c("div", [
        _vm._v("x: "),
        _c("input", {
          domProps: { value: _vm.x },
          on: {
            input: function($event) {
              return _vm.handleChange($event, "x")
            }
          }
        })
      ]),
      _vm._v(" "),
      _c("div", [
        _vm._v("y: "),
        _c("input", {
          domProps: { value: _vm.y },
          on: {
            input: function($event) {
              return _vm.handleChange($event, "y")
            }
          }
        })
      ]),
      _vm._v(" "),
      _c("div", [
        _vm._v("z: "),
        _c("input", {
          domProps: { value: _vm.z },
          on: {
            input: function($event) {
              return _vm.handleChange($event, "z")
            }
          }
        })
      ]),
      _vm._v(" "),
      _c("div", [
        _vm._v("r: "),
        _c("input", {
          domProps: { value: _vm.r },
          on: {
            input: function($event) {
              return _vm.handleChange($event, "r")
            }
          }
        })
      ]),
      _vm._v(" "),
      _c("div", [
        _vm._v("name: "),
        _c("input", {
          domProps: { value: _vm.name },
          on: {
            input: function($event) {
              return _vm.handleChange($event, "name")
            }
          }
        })
      ])
    ]
  )
};
var __vue_staticRenderFns__$2 = [];
__vue_render__$2._withStripped = true;

  /* style */
  var __vue_inject_styles__$2 = function (inject) {
    if (!inject) { return }
    inject("data-v-de3dcfea_0", { source: "input[data-v-de3dcfea] {\n  border: 1px solid #000;\n  margin: 10px;\n}\n\n/*# sourceMappingURL=editor.vue.map */", map: {"version":3,"sources":["/Users/deot/Desktop/wya/github/wya-vm/src/combo/modules/__tpl__/editor.vue","editor.vue"],"names":[],"mappings":"AAgDA;EACA,sBAAA;EACA,YAAA;AAAA;;AC9CA,qCAAqC","file":"editor.vue","sourcesContent":["<template>\n\t<div style=\"display: flex; flex-direction: column;\">\n\t\t<div>w: <input :value=\"w\" @input=\"handleChange($event, 'w')\"></div>\n\t\t<div>h: <input :value=\"h\" @input=\"handleChange($event, 'h')\"></div>\n\t\t<div>x: <input :value=\"x\" @input=\"handleChange($event, 'x')\"></div>\n\t\t<div>y: <input :value=\"y\" @input=\"handleChange($event, 'y')\"></div>\n\t\t<div>z: <input :value=\"z\" @input=\"handleChange($event, 'z')\"></div>\n\t\t<div>r: <input :value=\"r\" @input=\"handleChange($event, 'r')\"></div>\n\t\t<div>name: <input :value=\"name\" @input=\"handleChange($event, 'name')\"></div>\n\t</div>\n</template>\n\n<script>\n\nexport default {\n\tname: 'vm-tpl-editor',\n\tcomponents: {\n\t},\n\tprops: {\n\t\tw: Number,\n\t\th: Number,\n\t\tr: Number,\n\t\tx: Number,\n\t\ty: Number,\n\t\tz: Number,\n\t\tname: [Number, String],\n\t},\n\tdata() {\n\t\treturn {\n\t\t};\n\t},\n\tcomputed: {\n\t},\n\tcreated() {\n\t},\n\tmethods: {\n\t\thandleChange(e, key) {\n\t\t\tthis.$emit('change', { [key]: e.target.value });\n\t\t},\n\t\thandleClick() {\n\t\t\t// this.$emit('update:x', this.x + 1);\n\t\t\tthis.$emit('change', { x: this.x + 1 });\n\t\t}\n\t},\n};\n</script>\n\n<style lang=\"scss\" scoped>\ninput {\n\tborder: 1px solid #000;\n\tmargin: 10px;\n}\n</style>\n","input {\n  border: 1px solid #000;\n  margin: 10px; }\n\n/*# sourceMappingURL=editor.vue.map */"]}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$2 = "data-v-de3dcfea";
  /* module identifier */
  var __vue_module_identifier__$2 = undefined;
  /* functional template */
  var __vue_is_functional_template__$2 = false;
  /* style inject SSR */
  

  
  var Editor = normalizeComponent_1(
    { render: __vue_render__$2, staticRenderFns: __vue_staticRenderFns__$2 },
    __vue_inject_styles__$2,
    __vue_script__$2,
    __vue_scope_id__$2,
    __vue_is_functional_template__$2,
    __vue_module_identifier__$2,
    browser,
    undefined
  );

var tpl = {
  module: "tpl",
  type: '基础组件',
  name: "模版",
  Viewer: Viewer,
  Editor: Editor,
  // 初始数据
  data: {
    // for draggable
    w: 200,
    h: 150,
    r: 0,
    x: 0,
    // 动态分配
    y: 0,
    // 动态分配
    z: 1,
    parent: false,
    // for content
    name: '名称'
  },
  dataValidity: function dataValidity() {
    var res = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    if (!res.name) {
      return {
        error: "输入框内容必填"
      };
    }

    return null;
  }
};

/**
 * roots
 */
var defaultModules = {
  tpl: tpl
};

//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
var script$3 = {
  name: 'vm-tools-operation',
  components: {},
  props: {
    total: Number,
    current: Number,
    isEdit: Boolean
  },
  data: function data() {
    return {};
  },
  computed: {},
  watch: {},
  created: function created() {},
  methods: {
    handleUndo: function handleUndo() {
      this.$emit('undo');
    },
    handleRedo: function handleRedo() {
      this.$emit('redo');
    },
    handleDelete: function handleDelete() {
      this.$emit('delete');
    }
  }
};

/* script */
var __vue_script__$3 = script$3;

/* template */
var __vue_render__$3 = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c("div", { staticClass: "vm-tools-operation vm-hack-editor" }, [
    _c(
      "div",
      { class: { disabled: _vm.current === 0 }, on: { click: _vm.handleUndo } },
      [_vm._v("←")]
    ),
    _vm._v(" "),
    _c(
      "div",
      {
        class: { disabled: _vm.current === _vm.total },
        on: { click: _vm.handleRedo }
      },
      [_vm._v("→")]
    ),
    _vm._v(" "),
    _c(
      "div",
      { class: { disabled: !_vm.isEdit }, on: { click: _vm.handleDelete } },
      [_vm._v("✕")]
    ),
    _vm._v(" "),
    _c("span", [
      _vm._v(
        "\n\t\tcur: " +
          _vm._s(_vm.current) +
          "\n\t\tlast: " +
          _vm._s(_vm.total) +
          "\n\t"
      )
    ])
  ])
};
var __vue_staticRenderFns__$3 = [];
__vue_render__$3._withStripped = true;

  /* style */
  var __vue_inject_styles__$3 = function (inject) {
    if (!inject) { return }
    inject("data-v-5c057320_0", { source: ".vm-tools-operation[data-v-5c057320] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  cursor: pointer;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.vm-tools-operation div[data-v-5c057320] {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    width: 30px;\n    height: 30px;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n}\n.vm-tools-operation .disabled[data-v-5c057320] {\n    pointer-events: none;\n    color: #ccc;\n}\n\n/*# sourceMappingURL=operation.vue.map */", map: {"version":3,"sources":["/Users/deot/Desktop/wya/github/wya-vm/src/combo/tools/operation.vue","operation.vue"],"names":[],"mappings":"AA2DA;EACA,oBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,eAAA;EACA,yBAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAAA;AAJA;IAMA,oBAAA;IAAA,oBAAA;IAAA,aAAA;IACA,yBAAA;QAAA,sBAAA;YAAA,mBAAA;IACA,wBAAA;QAAA,qBAAA;YAAA,uBAAA;IACA,WAAA;IACA,YAAA;IACA,yBAAA;OAAA,sBAAA;QAAA,qBAAA;YAAA,iBAAA;AAAA;AAXA;IAcA,oBAAA;IACA,WAAA;AAAA;;AC1DA,wCAAwC","file":"operation.vue","sourcesContent":["<template>\n\t<div class=\"vm-tools-operation vm-hack-editor\">\n\t\t<div \n\t\t\t:class=\"{ disabled: current === 0 }\" \n\t\t\t@click=\"handleUndo\"\n\t\t>←</div>\n\t\t<div \n\t\t\t:class=\"{ disabled: current === total }\" \n\t\t\t@click=\"handleRedo\"\n\t\t>→</div>\n\t\t<div \n\t\t\t:class=\"{ disabled: !isEdit }\" \n\t\t\t@click=\"handleDelete\"\n\t\t>✕</div>\n\t\t<span>\n\t\t\tcur: {{ current }}\n\t\t\tlast: {{ total }}\n\t\t</span>\n\t</div>\n</template>\n\n<script>\n\nexport default {\n\tname: 'vm-tools-operation',\n\tcomponents: {\n\t},\n\tprops: {\n\t\ttotal: Number,\n\t\tcurrent: Number,\n\t\tisEdit: Boolean\n\t},\n\tdata() {\n\t\treturn {\n\t\t};\n\t},\n\tcomputed: {\n\n\t},\n\twatch: {\n\t\t\n\t},\n\tcreated() {\n\t},\n\tmethods: {\n\t\thandleUndo() {\n\t\t\tthis.$emit('undo');\n\t\t},\n\t\thandleRedo() {\n\t\t\tthis.$emit('redo');\n\t\t},\n\t\thandleDelete() {\n\t\t\tthis.$emit('delete');\n\t\t}\n\t},\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.vm-tools-operation {\n\tdisplay: flex;\n\tcursor: pointer;\n\talign-items: center;\n\tuser-select: none;\n\tdiv {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\twidth: 30px;\n\t\theight: 30px;\n\t\tuser-select: none;\n\t}\n\t.disabled {\n\t\tpointer-events: none;\n\t\tcolor: #ccc;\n\t}\n}\n</style>\n",".vm-tools-operation {\n  display: flex;\n  cursor: pointer;\n  align-items: center;\n  user-select: none; }\n  .vm-tools-operation div {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 30px;\n    height: 30px;\n    user-select: none; }\n  .vm-tools-operation .disabled {\n    pointer-events: none;\n    color: #ccc; }\n\n/*# sourceMappingURL=operation.vue.map */"]}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$3 = "data-v-5c057320";
  /* module identifier */
  var __vue_module_identifier__$3 = undefined;
  /* functional template */
  var __vue_is_functional_template__$3 = false;
  /* style inject SSR */
  

  
  var ToolsOperation = normalizeComponent_1(
    { render: __vue_render__$3, staticRenderFns: __vue_staticRenderFns__$3 },
    __vue_inject_styles__$3,
    __vue_script__$3,
    __vue_scope_id__$3,
    __vue_is_functional_template__$3,
    __vue_module_identifier__$3,
    browser,
    undefined
  );

//
//
//
//
//
//
//
var script$4 = {
  name: 'vm-tools-save',
  components: {},
  props: {},
  data: function data() {
    return {};
  },
  computed: {},
  watch: {},
  created: function created() {},
  methods: {}
};

/* script */
var __vue_script__$4 = script$4;

/* template */
var __vue_render__$4 = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c("div", { staticClass: "vm-tools-save vm-hack-editor" }, [
    _c(
      "div",
      {
        on: {
          click: function($event) {
            return _vm.$emit("save")
          }
        }
      },
      [_vm._v("保存")]
    ),
    _vm._v(" "),
    _c(
      "div",
      {
        on: {
          click: function($event) {
            return _vm.$emit("preview")
          }
        }
      },
      [_vm._v("预览")]
    )
  ])
};
var __vue_staticRenderFns__$4 = [];
__vue_render__$4._withStripped = true;

  /* style */
  var __vue_inject_styles__$4 = function (inject) {
    if (!inject) { return }
    inject("data-v-c3554374_0", { source: ".vm-tools-save[data-v-c3554374] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  cursor: pointer;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.vm-tools-save div[data-v-c3554374] {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    width: 30px;\n    height: 30px;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n}\n.vm-tools-save .disabled[data-v-c3554374] {\n    pointer-events: none;\n    color: #ccc;\n}\n\n/*# sourceMappingURL=save.vue.map */", map: {"version":3,"sources":["/Users/deot/Desktop/wya/github/wya-vm/src/combo/tools/save.vue","save.vue"],"names":[],"mappings":"AAgCA;EACA,oBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,eAAA;EACA,yBAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAAA;AAJA;IAMA,oBAAA;IAAA,oBAAA;IAAA,aAAA;IACA,yBAAA;QAAA,sBAAA;YAAA,mBAAA;IACA,wBAAA;QAAA,qBAAA;YAAA,uBAAA;IACA,WAAA;IACA,YAAA;IACA,yBAAA;OAAA,sBAAA;QAAA,qBAAA;YAAA,iBAAA;AAAA;AAXA;IAcA,oBAAA;IACA,WAAA;AAAA;;AC/BA,mCAAmC","file":"save.vue","sourcesContent":["<template>\n\t<div class=\"vm-tools-save vm-hack-editor\">\n\t\t<div @click=\"$emit('save')\">保存</div>\n\t\t<div @click=\"$emit('preview')\">预览</div>\n\t</div>\n</template>\n\n<script>\nexport default {\n\tname: 'vm-tools-save',\n\tcomponents: {\n\t},\n\tprops: {\n\t},\n\tdata() {\n\t\treturn {\n\t\t};\n\t},\n\tcomputed: {\n\n\t},\n\twatch: {\n\t\t\n\t},\n\tcreated() {\n\t},\n\tmethods: {\n\t},\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.vm-tools-save {\n\tdisplay: flex;\n\tcursor: pointer;\n\talign-items: center;\n\tuser-select: none;\n\tdiv {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\twidth: 30px;\n\t\theight: 30px;\n\t\tuser-select: none;\n\t}\n\t.disabled {\n\t\tpointer-events: none;\n\t\tcolor: #ccc;\n\t}\n}\n</style>\n",".vm-tools-save {\n  display: flex;\n  cursor: pointer;\n  align-items: center;\n  user-select: none; }\n  .vm-tools-save div {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 30px;\n    height: 30px;\n    user-select: none; }\n  .vm-tools-save .disabled {\n    pointer-events: none;\n    color: #ccc; }\n\n/*# sourceMappingURL=save.vue.map */"]}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$4 = "data-v-c3554374";
  /* module identifier */
  var __vue_module_identifier__$4 = undefined;
  /* functional template */
  var __vue_is_functional_template__$4 = false;
  /* style inject SSR */
  

  
  var ToolsSave = normalizeComponent_1(
    { render: __vue_render__$4, staticRenderFns: __vue_staticRenderFns__$4 },
    __vue_inject_styles__$4,
    __vue_script__$4,
    __vue_scope_id__$4,
    __vue_is_functional_template__$4,
    __vue_module_identifier__$4,
    browser,
    undefined
  );

var wrapper = {
  name: 'vm-preview',
  components: {},
  props: {
    dataSource: Array,
    css: {
      type: Object,
      default: function _default() {
        return {
          style: {},
          className: ""
        };
      }
    },
    animation: {
      type: String,
      default: 'fade'
    },
    mask: {
      type: Boolean,
      default: true
    }
  },
  data: function data() {
    return {
      visible: false,
      transform: "translate(-100px, -100px)"
    };
  },
  computed: {},
  watch: {},
  mounted: function mounted() {
    this.visible = true;
  },
  updated: function updated() {},
  methods: {
    handleClose: function handleClose() {
      var _this = this;

      this.visible = false;
      setTimeout(function () {
        _this.$emit('close');
      }, 300); // 动画时间
    }
  }
};
var Dom = document.body;
var Preview = {
  vm: null,
  show: function show() {
    var _this2 = this;

    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    var _opts$components = opts.components,
        components = _opts$components === void 0 ? {} : _opts$components,
        rest = _objectWithoutProperties(opts, ["components"]); // 清理缓存


    components = clearCtor(components);
    var div = document.createElement('div');
    var VueComponent = Vue.extend(cloneDeep(_objectSpread({}, wrapper, {
      components: _objectSpread({}, wrapper.components, components)
    }))); // 先销毁

    this.vm && this.vm.$emit('close');
    this.vm = new VueComponent({
      el: div,
      propsData: _objectSpread({}, rest)
    });
    this.vm.$on('close', function () {
      _this2.vm.$destroy(); // 主动卸载节点


      Dom.removeChild(_this2.vm.$el);
    });
    Dom.appendChild(this.vm.$el);
    return this.vm;
  },
  hide: function hide() {
    this.vm && this.vm.$emit('close');
  }
};

/* script */
var __vue_script__$5 = wrapper;

/* template */
var __vue_render__$5 = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c(
    "div",
    { staticClass: "vm-tools-preview" },
    [
      _vm.mask
        ? _c("transition", { attrs: { name: _vm.animation } }, [
            _c("div", {
              directives: [
                {
                  name: "show",
                  rawName: "v-show",
                  value: _vm.visible,
                  expression: "visible"
                }
              ],
              staticClass: "__mask",
              on: { click: _vm.handleClose }
            })
          ])
        : _vm._e(),
      _vm._v(" "),
      _vm.mask
        ? _c("transition", { attrs: { name: _vm.animation } }, [
            _c(
              "div",
              {
                directives: [
                  {
                    name: "show",
                    rawName: "v-show",
                    value: _vm.visible,
                    expression: "visible"
                  }
                ],
                staticClass: "__close",
                on: { click: _vm.handleClose }
              },
              [_vm._v("✕")]
            )
          ])
        : _vm._e(),
      _vm._v(" "),
      _c("transition", { attrs: { name: _vm.animation } }, [
        _c(
          "div",
          {
            directives: [
              {
                name: "show",
                rawName: "v-show",
                value: _vm.visible,
                expression: "visible"
              }
            ],
            staticClass: "__content"
          },
          [
            _c(
              "div",
              {
                class: _vm.css.className,
                staticStyle: { position: "relative" },
                style: _vm.css.style
              },
              _vm._l(_vm.dataSource, function(it) {
                return _c(
                  "div",
                  {
                    key: it.id,
                    style: {
                      position: "absolute",
                      width: "" + (it.w ? it.w + "px" : "auto"),
                      height: "" + (it.h ? it.h + "px" : "auto"),
                      left: it.x + "px",
                      top: it.y + "px",
                      transform: "rotate(" + it.r + "deg)"
                    }
                  },
                  [
                    _c(
                      "vm-" + it.module + "-viewer",
                      _vm._b({ tag: "component" }, "component", it, false)
                    )
                  ],
                  1
                )
              }),
              0
            )
          ]
        )
      ])
    ],
    1
  )
};
var __vue_staticRenderFns__$5 = [];
__vue_render__$5._withStripped = true;

  /* style */
  var __vue_inject_styles__$5 = function (inject) {
    if (!inject) { return }
    inject("data-v-af214562_0", { source: ".vm-tools-preview[data-v-af214562] {\n  position: fixed;\n  top: 0;\n  right: 0;\n  left: 0;\n  bottom: 0;\n  z-index: 999;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.vm-tools-preview .__mask[data-v-af214562] {\n    position: absolute;\n    z-index: 997;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, .2);\n    -webkit-transition: opacity 0.2s;\n    transition: opacity 0.2s;\n}\n.vm-tools-preview .__content[data-v-af214562] {\n    position: relative;\n    z-index: 998;\n    overflow: auto;\n    max-height: 100vh;\n    max-width: 100vw;\n    -webkit-transition: opacity 0.2s, -webkit-transform 0.2s;\n    transition: opacity 0.2s, -webkit-transform 0.2s;\n    transition: transform 0.2s, opacity 0.2s;\n    transition: transform 0.2s, opacity 0.2s, -webkit-transform 0.2s;\n}\n.vm-tools-preview .__close[data-v-af214562] {\n    position: absolute;\n    right: 30px;\n    top: 30px;\n    font-size: 24px;\n    z-index: 999;\n}\n.fade-enter[data-v-af214562], .fade-leave-active[data-v-af214562] {\n  opacity: 0;\n}\n\n/*# sourceMappingURL=preview.vue.map */", map: {"version":3,"sources":["/Users/deot/Desktop/wya/github/wya-vm/src/combo/tools/preview.vue","preview.vue"],"names":[],"mappings":"AA8HA;EACA,eAAA;EACA,MAAA;EACA,QAAA;EACA,OAAA;EACA,SAAA;EACA,YAAA;EACA,oBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,yBAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,wBAAA;MAAA,qBAAA;UAAA,uBAAA;AAAA;AATA;IAWA,kBAAA;IACA,YAAA;IACA,MAAA;IACA,OAAA;IACA,WAAA;IACA,YAAA;IACA,mCAAA;IAEA,gCAAA;IAAA,wBAAA;AAAA;AAnBA;IAsBA,kBAAA;IACA,YAAA;IACA,cAAA;IACA,iBAAA;IACA,gBAAA;IACA,wDAAA;IAAA,gDAAA;IAAA,wCAAA;IAAA,gEAAA;AAAA;AA3BA;IA8BA,kBAAA;IACA,WAAA;IACA,SAAA;IACA,eAAA;IACA,YAAA;AAAA;AAGA;EACA,UAAA;AAAA;;AChIA,sCAAsC","file":"preview.vue","sourcesContent":["<template>\n\t<div class=\"vm-tools-preview\">\n\t\t<transition v-if=\"mask\" :name=\"animation\" >\n\t\t\t<div v-show=\"visible\" class=\"__mask\" @click=\"handleClose\" />\n\t\t</transition>\n\t\t<transition v-if=\"mask\" :name=\"animation\" >\n\t\t\t<div v-show=\"visible\" class=\"__close\" @click=\"handleClose\">&#10005;</div>\n\t\t</transition>\n\t\t<transition :name=\"animation\">\n\t\t\t<div v-show=\"visible\" class=\"__content\">\n\t\t\t\t<div :style=\"css.style\" :class=\"css.className\" style=\"position: relative;\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-for=\"(it) in dataSource\" \n\t\t\t\t\t\t:key=\"it.id\" \n\t\t\t\t\t\t:style=\"{ \n\t\t\t\t\t\t\tposition: 'absolute', \n\t\t\t\t\t\t\twidth: `${it.w ? `${it.w}px` : 'auto' }`, \n\t\t\t\t\t\t\theight: `${it.h ? `${it.h}px` : 'auto' }`, \n\t\t\t\t\t\t\tleft: `${it.x}px`, \n\t\t\t\t\t\t\ttop: `${it.y}px`, \n\t\t\t\t\t\t\ttransform: `rotate(${it.r}deg)`\n\t\t\t\t\t\t}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is=\"`vm-${it.module}-viewer`\" \n\t\t\t\t\t\t\tv-bind=\"it\" \n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t</div>\n</template>\n\n<script>\nimport Vue from 'vue';\nimport { cloneDeep, clearCtor } from '../../utils/helper';\n\nconst wrapper = {\n\tname: 'vm-preview',\n\tcomponents: {\n\t\t\n\t},\n\tprops: {\n\t\tdataSource: Array,\n\t\tcss: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({ style: {}, className: \"\" })\n\t\t},\n\t\tanimation: {\n\t\t\ttype: String,\n\t\t\tdefault: 'fade'\n\t\t},\n\t\tmask: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tvisible: false,\n\t\t\ttransform: `translate(-100px, -100px)`\n\t\t};\n\t},\n\tcomputed: {\n\n\t},\n\twatch: {\n\t\t\n\t},\n\tmounted() {\n\t\tthis.visible = true;\n\t},\n\tupdated() {\n\t},\n\tmethods: {\n\t\thandleClose() {\n\t\t\tthis.visible = false;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.$emit('close');\n\t\t\t}, 300); // 动画时间\n\t\t}\n\t},\n};\nexport default wrapper;\n\nlet Dom = document.body;\nexport const Preview = {\n\tvm: null,\n\tshow(opts = {}) {\n\t\tlet { components = {}, ...rest } = opts;\n\n\t\t// 清理缓存\n\t\tcomponents = clearCtor(components);\n\n\t\tconst div = document.createElement('div');\n\t\tconst VueComponent = Vue.extend(cloneDeep({ \n\t\t\t...wrapper, \n\t\t\tcomponents: { \n\t\t\t\t...wrapper.components, \n\t\t\t\t...components \n\t\t\t} \n\t\t}));\n\t\t// 先销毁\n\t\tthis.vm && this.vm.$emit('close');\n\t\tthis.vm = new VueComponent({\n\t\t\tel: div,\n\t\t\tpropsData: {\n\t\t\t\t...rest\n\t\t\t}\n\t\t});\n\t\tthis.vm.$on('close', () => {\n\t\t\tthis.vm.$destroy();\n\t\t\t// 主动卸载节点\n\t\t\tDom.removeChild(this.vm.$el);\n\t\t});\n\t\tDom.appendChild(this.vm.$el);\n\t\treturn this.vm;\n\t},\n\thide() {\n\t\tthis.vm && this.vm.$emit('close');\n\t}\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.vm-tools-preview {\n\tposition: fixed;\n\ttop: 0;\n\tright: 0;\n\tleft: 0;\n\tbottom: 0;\n\tz-index: 999;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\t.__mask {\n\t\tposition: absolute;\n\t\tz-index: 997;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tbackground-color: rgba(#000, 0.2);\n\t\t// opacity: 0;\n\t\ttransition: opacity 0.2s;\n\t}\n\t.__content {\n\t\tposition: relative;\n\t\tz-index: 998;\n\t\toverflow: auto; // 区域之外不形式\n\t\tmax-height: 100vh; \n\t\tmax-width: 100vw; \n\t\ttransition: transform 0.2s, opacity 0.2s;\n\t}\n\t.__close {\n\t\tposition: absolute;\n\t\tright: 30px; \n\t\ttop: 30px;\n\t\tfont-size: 24px;\n\t\tz-index: 999;\n\t}\n}\n.fade-enter, .fade-leave-active {\n\topacity: 0;\n}\n</style>\n",".vm-tools-preview {\n  position: fixed;\n  top: 0;\n  right: 0;\n  left: 0;\n  bottom: 0;\n  z-index: 999;\n  display: flex;\n  align-items: center;\n  justify-content: center; }\n  .vm-tools-preview .__mask {\n    position: absolute;\n    z-index: 997;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.2);\n    transition: opacity 0.2s; }\n  .vm-tools-preview .__content {\n    position: relative;\n    z-index: 998;\n    overflow: auto;\n    max-height: 100vh;\n    max-width: 100vw;\n    transition: transform 0.2s, opacity 0.2s; }\n  .vm-tools-preview .__close {\n    position: absolute;\n    right: 30px;\n    top: 30px;\n    font-size: 24px;\n    z-index: 999; }\n\n.fade-enter, .fade-leave-active {\n  opacity: 0; }\n\n/*# sourceMappingURL=preview.vue.map */"]}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$5 = "data-v-af214562";
  /* module identifier */
  var __vue_module_identifier__$5 = undefined;
  /* functional template */
  var __vue_is_functional_template__$5 = false;
  /* style inject SSR */
  

  
  var ToolsPreview = normalizeComponent_1(
    { render: __vue_render__$5, staticRenderFns: __vue_staticRenderFns__$5 },
    __vue_inject_styles__$5,
    __vue_script__$5,
    __vue_scope_id__$5,
    __vue_is_functional_template__$5,
    __vue_module_identifier__$5,
    browser,
    undefined
  );

var script$5 = {
  name: 'vm-combo',
  components: {
    // 会被注入vm-frame, vm-tools-widget, vm-editor,
    'vm-tools-operation': ToolsOperation,
    'vm-tools-save': ToolsSave
  },
  props: {
    width: Number,
    height: Number,
    mode: {
      type: String,
      default: 'free' // sort-list

    },
    dataSource: {
      type: Array,
      default: function _default() {
        return [];
      }
    },

    /**
     * frame
     */
    frameStyle: Object,
    frameW: Number,
    frameH: Number,
    frameOpts: Object,

    /**
     * tools
     */
    toolsStyle: Object,
    toolsW: Number,
    toolsH: Number,
    toolsOpts: Object
  },
  data: function data() {
    return {
      editor: null,
      dragging: false,
      resizing: false,

      /**
       * vm-tools-operation
       */
      current: 0,
      total: 0,
      rebuildData: []
    };
  },
  computed: {
    style: function style() {
      var w = this.width === 0 ? 'auto' : "".concat(this.width, "px");
      var h = this.height === 0 ? 'auto' : "".concat(this.height, "px");
      return {
        width: w,
        height: h
      };
    }
  },
  watch: {
    dataSource: {
      deep: true,
      handler: function handler() {
        // todo, 是否重写
        this.rebuildData = cloneDeep(this.dataSource);
      }
    }
  },
  created: function created() {
    this.historyData = [];
    this.rebuildData = cloneDeep(this.dataSource);
  },
  destroyed: function destroyed() {
    Preview.hide();
  },
  methods: {
    /**
     * 目前只支持以下几种数据
     * current, total
     */
    sync: function sync(opts) {
      for (var key in opts) {
        if (this[key] != opts[key]) {
          this.$emit("update:".concat(key), opts[key]);
        }
      }
    },

    /**
     * draggable
     */
    handleActivated: function handleActivated(it) {
      this.editor = it;
    },
    handleDeactivated: function handleDeactivated(it) {
      this.editor = null;
    },

    /**
     * 数据变化
     */
    handleChange: function handleChange(_ref) {
      var type = _ref.type,
          id = _ref.id,
          index = _ref.index,
          old = _ref.old;

      if (!type || !id) {
        console.error('[wya-vm/combo]: id, type is required');
      }

      var current = this.current,
          total = this.total;
      var target = {
        type: type,
        id: id,
        old: old,
        index: typeof index === 'undefined' ? this.rebuildData.findIndex(function (item) {
          return item.id === id;
        }) : index,
        data: cloneDeep(this.rebuildData.find(function (item) {
          return item.id === id;
        }))
      };
      current === total ? this.historyData.push(target) : this.historyData.splice(current, total - current, target);
      var length = this.historyData.length;
      this.current = length;
      this.total = length;
      type === 'delete' && (this.rebuildData.splice(target.index, 1), this.editor = null);
    },

    /**
     * tools-operation
     */
    handleOperate: function handleOperate(type) {
      this[type] && this[type]();
    },
    delete: function _delete() {
      var _ref2 = this.editor || {},
          id = _ref2.id;

      if (!id) {
        this.$emit('error', {
          type: 'id',
          msg: "请先选择操作对象"
        });
        return;
      }

      this.handleChange({
        type: 'delete',
        id: id
      });
    },
    undo: function undo() {
      var current = this.current - 1;

      if (current < 0) {
        this.$emit('error', {
          type: 'undo',
          msg: "目前已经是初始状态"
        });
        return;
      }

      this.current = current;

      var _ref3 = this.historyData[this.current] || {},
          type = _ref3.type,
          id = _ref3.id,
          data = _ref3.data,
          index = _ref3.index,
          old = _ref3.old;

      switch (type) {
        case 'create':
          this.rebuildData.splice(index, 1);
          break;

        case 'delete':
          this.rebuildData.splice(index, 0, data);
          break;

        case 'update':
          this.rebuildData.splice(index, 1, cloneDeep(_objectSpread({}, data, old)));
          break;

        default:
          break;
      }

      if (this.editor && this.editor.id === id) {
        this.editor = this.rebuildData[index];
      }
    },
    redo: function redo() {
      var current = this.current + 1;

      if (current > this.total) {
        this.$emit('error', {
          type: 'undo',
          msg: "目前已经是最终状态"
        });
        return;
      }

      this.current = current;
      var _this$historyData = this.historyData[this.current - 1],
          type = _this$historyData.type,
          id = _this$historyData.id,
          data = _this$historyData.data,
          index = _this$historyData.index;

      switch (type) {
        case 'create':
          this.rebuildData.splice(index, 1, data);
          break;

        case 'delete':
          this.rebuildData.splice(index, 1);
          break;

        case 'update':
          this.rebuildData.splice(index, 1, data);
          break;

        default:
          break;
      }

      if (this.editor && this.editor.id === id) {
        this.editor = this.rebuildData[index];
      }
    },

    /**
     * tools-save
     */
    save: function save() {
      var data = cloneDeep(this.rebuildData) || [];

      if (data.length === 0) {
        this.$emit('error', {
          type: 'save',
          msg: "\u4FDD\u5B58\u5BF9\u8C61\u4E0D\u80FD\u4E3A\u7A7A"
        });
        return;
      }

      var modules = this.$options.modules;

      for (var i = 0; i < data.length; i++) {
        var mod = data[i].module;

        if (modules[mod].dataValidity) {
          var error = modules[mod].dataValidity(data[i]);

          if (error) {
            this.$emit('error', {
              type: 'save',
              msg: "\u7B2C".concat(i + 1, "\u4E2A - ").concat(error.error),
              index: i
            }); // 错误元素激活

            this.$refs.frame.setActived(i);
            return;
          }
        }
      }
      /**
       * 数据验证
       */


      this.$emit('save', data);
    },
    preview: function preview() {
      if (this.rebuildData.length === 0) {
        this.$emit('error', {
          type: 'preview',
          msg: "\u9884\u89C8\u6570\u636E\u5BF9\u8C61\u4E0D\u80FD\u4E3A\u7A7A"
        });
        return;
      }

      Preview.show({
        components: this.$options.viewers,
        dataSource: cloneDeep(this.rebuildData),
        css: {
          style: _objectSpread({}, this.frameStyle, {
            width: this.frameW === 0 ? 'auto' : "".concat(this.frameW, "px"),
            height: this.frameH === 0 ? 'auto' : "".concat(this.frameH, "px")
          }),
          className: '__frame'
        }
      });
    }
  }
};

/* script */
var __vue_script__$6 = script$5;

/* template */
var __vue_render__$6 = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c(
    "div",
    { staticClass: "vm-combo", style: _vm.style },
    [
      _c(
        "vm-tools-widget",
        _vm._b(
          { staticClass: "__tools", style: _vm.toolsStyle },
          "vm-tools-widget",
          _vm.toolsOpts,
          false
        )
      ),
      _vm._v(" "),
      _c("vm-tools-save", {
        on: {
          save: function($event) {
            return _vm.handleOperate("save")
          },
          preview: function($event) {
            return _vm.handleOperate("preview")
          }
        }
      }),
      _vm._v(" "),
      _c("vm-tools-operation", {
        attrs: {
          current: _vm.current,
          total: _vm.total,
          "is-edit": !!_vm.editor
        },
        on: {
          undo: function($event) {
            return _vm.handleOperate("undo")
          },
          redo: function($event) {
            return _vm.handleOperate("redo")
          },
          delete: function($event) {
            return _vm.handleOperate("delete")
          }
        }
      }),
      _vm._v(" "),
      _c(
        "vm-frame",
        _vm._b(
          {
            ref: "frame",
            staticClass: "__frame",
            style: _vm.frameStyle,
            attrs: {
              width: _vm.frameW,
              height: _vm.frameH,
              "data-source": _vm.rebuildData,
              editor: _vm.editor
            },
            on: {
              activated: _vm.handleActivated,
              deactivated: _vm.handleDeactivated,
              change: _vm.handleChange
            }
          },
          "vm-frame",
          _vm.frameOpts,
          false
        )
      ),
      _vm._v(" "),
      _vm.editor
        ? _c("vm-editor", {
            attrs: { "data-source": _vm.editor },
            on: { change: _vm.handleChange }
          })
        : _vm._e()
    ],
    1
  )
};
var __vue_staticRenderFns__$6 = [];
__vue_render__$6._withStripped = true;

  /* style */
  var __vue_inject_styles__$6 = function (inject) {
    if (!inject) { return }
    inject("data-v-5d91f41b_0", { source: "\n/*# sourceMappingURL=combo.vue.map */", map: {"version":3,"sources":["combo.vue"],"names":[],"mappings":";AACA,oCAAoC","file":"combo.vue","sourcesContent":["\n/*# sourceMappingURL=combo.vue.map */"]}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$6 = "data-v-5d91f41b";
  /* module identifier */
  var __vue_module_identifier__$6 = undefined;
  /* functional template */
  var __vue_is_functional_template__$6 = false;
  /* style inject SSR */
  

  
  var Combo = normalizeComponent_1(
    { render: __vue_render__$6, staticRenderFns: __vue_staticRenderFns__$6 },
    __vue_inject_styles__$6,
    __vue_script__$6,
    __vue_scope_id__$6,
    __vue_is_functional_template__$6,
    __vue_module_identifier__$6,
    browser,
    undefined
  );

//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
var script$6 = {
  name: 'vm-grid-lines',
  components: {},
  props: {
    width: Number,
    height: Number,
    grid: {
      type: Array,
      default: function _default() {
        return [10, 10];
      }
    }
  },
  data: function data() {
    return {};
  },
  computed: {
    xArr: function xArr() {
      var _this = this;

      var length = Math.floor(this.width / this.grid[0]);
      return Array.from({
        length: length
      }, function (v, i) {
        return i * _this.grid[0];
      });
    },
    yArr: function yArr() {
      var _this2 = this;

      var length = Math.floor(this.height / this.grid[1]);
      return Array.from({
        length: length
      }, function (v, i) {
        return i * _this2.grid[1];
      });
    }
  },
  watch: {},
  created: function created() {},
  methods: {}
};

/* script */
var __vue_script__$7 = script$6;

/* template */
var __vue_render__$7 = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c(
    "div",
    { staticClass: "vm-grid-lines" },
    [
      _vm._l(_vm.yArr, function(item) {
        return _c("div", {
          key: "y_" + item,
          staticClass: "__y",
          style: { top: item + "px" }
        })
      }),
      _vm._v(" "),
      _vm._l(_vm.xArr, function(item) {
        return _c("div", {
          key: "x_" + item,
          staticClass: "__x",
          style: { left: item + "px" }
        })
      })
    ],
    2
  )
};
var __vue_staticRenderFns__$7 = [];
__vue_render__$7._withStripped = true;

  /* style */
  var __vue_inject_styles__$7 = function (inject) {
    if (!inject) { return }
    inject("data-v-64292bc8_0", { source: ".vm-grid-lines[data-v-64292bc8] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  z-index: 0;\n}\n.vm-grid-lines .__x[data-v-64292bc8] {\n    position: absolute;\n    left: 0;\n    width: 1px;\n    height: 100%;\n    border-left-width: 1px;\n    border-left-style: dotted;\n    border-left-color: #d6d6d6;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n.vm-grid-lines .__y[data-v-64292bc8] {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    height: 1px;\n    border-top-width: 1px;\n    border-top-style: dotted;\n    border-top-color: #d6d6d6;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n\n/*# sourceMappingURL=grid-lines.vue.map */", map: {"version":3,"sources":["/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/grid-lines.vue","grid-lines.vue"],"names":[],"mappings":"AA4DA;EACA,kBAAA;EACA,MAAA;EACA,OAAA;EACA,WAAA;EACA,YAAA;EACA,gBAAA;EACA,UAAA;AAAA;AAPA;IASA,kBAAA;IACA,OAAA;IACA,UAAA;IACA,YAAA;IACA,sBAAA;IACA,yBAAA;IACA,0BAAA;IACA,8BAAA;YAAA,sBAAA;AAAA;AAhBA;IAmBA,kBAAA;IACA,MAAA;IACA,WAAA;IACA,WAAA;IACA,qBAAA;IACA,wBAAA;IACA,yBAAA;IACA,8BAAA;YAAA,sBAAA;AAAA;;AC3DA,yCAAyC","file":"grid-lines.vue","sourcesContent":["<template>\n\t<div class=\"vm-grid-lines\">\n\t\t<div \n\t\t\tv-for=\"item in yArr\" \n\t\t\t:key=\"`y_${item}`\" \n\t\t\t:style=\"{top: `${item}px`}\"  \n\t\t\tclass=\"__y\"\n\t\t/>\n\t\t<div \n\t\t\tv-for=\"item in xArr\" \n\t\t\t:key=\"`x_${item}`\" \n\t\t\t:style=\"{left: `${item}px`}\"  \n\t\t\tclass=\"__x\"\n\t\t/>\n\t</div>\n</template>\n\n<script>\nexport default {\n\tname: 'vm-grid-lines',\n\tcomponents: {\n\n\t},\n\tprops: {\n\t\twidth: Number,\n\t\theight: Number,\n\t\tgrid: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => {\n\t\t\t\treturn [10, 10];\n\t\t\t}\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t};\n\t},\n\tcomputed: {\n\t\txArr() {\n\t\t\tlet length = Math.floor(this.width / this.grid[0]);\n\t\t\treturn Array.from({ length }, (v, i) => i * this.grid[0]);\n\t\t},\n\t\tyArr() {\n\t\t\tlet length = Math.floor(this.height / this.grid[1]);\n\t\t\treturn Array.from({ length }, (v, i) => i * this.grid[1]);\n\t\t}\n\t},\n\twatch: {\n\t\t\n\t},\n\tcreated() {\n\t\t\n\t},\n\tmethods: {\n\n\t},\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.vm-grid-lines {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\toverflow: hidden;\n\tz-index: 0;\n\t.__x {\n\t\tposition: absolute;\n\t\tleft: 0;\n\t\twidth: 1px;\n\t\theight: 100%;\n\t\tborder-left-width: 1px;\n\t\tborder-left-style: dotted;\n\t\tborder-left-color: rgb(214, 214, 214);\n\t\tbox-sizing: border-box;\n\t}\n\t.__y {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\twidth: 100%;\n\t\theight: 1px;\n\t\tborder-top-width: 1px;\n\t\tborder-top-style: dotted;\n\t\tborder-top-color: rgb(214, 214, 214); \n\t\tbox-sizing: border-box;\n\t}\n}\n</style>\n",".vm-grid-lines {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  z-index: 0; }\n  .vm-grid-lines .__x {\n    position: absolute;\n    left: 0;\n    width: 1px;\n    height: 100%;\n    border-left-width: 1px;\n    border-left-style: dotted;\n    border-left-color: #d6d6d6;\n    box-sizing: border-box; }\n  .vm-grid-lines .__y {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    height: 1px;\n    border-top-width: 1px;\n    border-top-style: dotted;\n    border-top-color: #d6d6d6;\n    box-sizing: border-box; }\n\n/*# sourceMappingURL=grid-lines.vue.map */"]}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$7 = "data-v-64292bc8";
  /* module identifier */
  var __vue_module_identifier__$7 = undefined;
  /* functional template */
  var __vue_is_functional_template__$7 = false;
  /* style inject SSR */
  

  
  var GridLines = normalizeComponent_1(
    { render: __vue_render__$7, staticRenderFns: __vue_staticRenderFns__$7 },
    __vue_inject_styles__$7,
    __vue_script__$7,
    __vue_scope_id__$7,
    __vue_is_functional_template__$7,
    __vue_module_identifier__$7,
    browser,
    undefined
  );

//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
var script$7 = {
  name: 'vm-align-lines',
  components: {},
  props: {
    dataSource: {
      type: Array,
      default: function _default() {
        return [];
      }
    },
    editor: Object
  },
  data: function data() {
    return {};
  },
  computed: {
    alignData: function alignData() {
      var _this = this;

      if (this.dataSource.length <= 1 || !this.editor) {
        return {
          xArr: [],
          yArr: []
        };
      }

      var _ref = this.editor || {},
          x = _ref.x,
          y = _ref.y,
          w = _ref.w,
          h = _ref.h;

      var xArr = [x, x + w / 2, x + w];
      var yArr = [y, y + h / 2, y + h];
      var xyObj = this.dataSource.reduce(function (result) {
        var itemData = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        var x = itemData.x,
            y = itemData.y,
            w = itemData.w,
            h = itemData.h,
            id = itemData.id;

        if (id !== _this.editor.id) {
          var _xArr = [x, x + w / 2, x + w];
          var _yArr = [y, y + h / 2, y + h];
          result.xArr = [].concat(_toConsumableArray(result.xArr), _xArr);
          result.yArr = [].concat(_toConsumableArray(result.yArr), _yArr);
        }

        return result;
      }, {
        xArr: [],
        yArr: []
      });
      return {
        xArr: xArr.filter(function (item) {
          return xyObj.xArr.includes(item);
        }),
        yArr: yArr.filter(function (item) {
          return xyObj.yArr.includes(item);
        })
      };
    }
  },
  watch: {},
  created: function created() {},
  methods: {}
};

/* script */
var __vue_script__$8 = script$7;

/* template */
var __vue_render__$8 = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c(
    "div",
    { staticClass: "vm-align-lines" },
    [
      _vm._l(_vm.alignData.yArr, function(item) {
        return _c("div", {
          key: "y_" + item,
          staticClass: "__y",
          style: { top: item + "px" }
        })
      }),
      _vm._v(" "),
      _vm._l(_vm.alignData.xArr, function(item) {
        return _c("div", {
          key: "x_" + item,
          staticClass: "__x",
          style: { left: item + "px" }
        })
      })
    ],
    2
  )
};
var __vue_staticRenderFns__$8 = [];
__vue_render__$8._withStripped = true;

  /* style */
  var __vue_inject_styles__$8 = function (inject) {
    if (!inject) { return }
    inject("data-v-47fe399b_0", { source: ".vm-align-lines[data-v-47fe399b] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  z-index: 0;\n}\n.vm-align-lines .__x[data-v-47fe399b] {\n    position: absolute;\n    left: 0;\n    width: 1px;\n    height: 100%;\n    border-left-width: 1px;\n    border-left-style: dotted;\n    border-left-color: #1fb6ff;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n.vm-align-lines .__y[data-v-47fe399b] {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    height: 1px;\n    border-top-width: 1px;\n    border-top-style: dotted;\n    border-top-color: #1fb6ff;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n\n/*# sourceMappingURL=align-lines.vue.map */", map: {"version":3,"sources":["/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/align-lines.vue","align-lines.vue"],"names":[],"mappings":"AA+EA;EACA,kBAAA;EACA,MAAA;EACA,OAAA;EACA,WAAA;EACA,YAAA;EACA,gBAAA;EACA,UAAA;AAAA;AAPA;IASA,kBAAA;IACA,OAAA;IACA,UAAA;IACA,YAAA;IACA,sBAAA;IACA,yBAAA;IACA,0BAAA;IACA,8BAAA;YAAA,sBAAA;AAAA;AAhBA;IAmBA,kBAAA;IACA,MAAA;IACA,WAAA;IACA,WAAA;IACA,qBAAA;IACA,wBAAA;IACA,yBAAA;IACA,8BAAA;YAAA,sBAAA;AAAA;;AC9EA,0CAA0C","file":"align-lines.vue","sourcesContent":["<template>\n\t<div class=\"vm-align-lines\">\n\t\t<div \n\t\t\tv-for=\"item in alignData.yArr\" \n\t\t\t:key=\"`y_${item}`\" \n\t\t\t:style=\"{top: `${item}px`}\"  \n\t\t\tclass=\"__y\"\n\t\t/>\n\t\t<div \n\t\t\tv-for=\"item in alignData.xArr\" \n\t\t\t:key=\"`x_${item}`\" \n\t\t\t:style=\"{left: `${item}px`}\"  \n\t\t\tclass=\"__x\"\n\t\t/>\n\t</div>\n</template>\n\n<script>\nexport default {\n\tname: 'vm-align-lines',\n\tcomponents: {\n\n\t},\n\tprops: {\n\t\tdataSource: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => ([])\n\t\t},\n\t\teditor: Object\n\t},\n\tdata() {\n\t\treturn {\n\t\t};\n\t},\n\tcomputed: {\n\t\talignData() {\n\t\t\tif (this.dataSource.length <= 1 || !this.editor) {\n\t\t\t\treturn {\n\t\t\t\t\txArr: [],\n\t\t\t\t\tyArr: []\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst { x, y, w, h } = this.editor || {};\n\t\t\tlet xArr = [x, x + w / 2, x + w];\n\t\t\tlet yArr = [y, y + h / 2, y + h];\n\n\t\t\tlet xyObj = this.dataSource.reduce((result, itemData = {}) => {\n\n\t\t\t\tconst { x, y, w, h, id } = itemData;\n\t\t\t\tif (id !== this.editor.id) {\n\t\t\t\t\tlet xArr = [x, x + w / 2, x + w];\n\t\t\t\t\tlet yArr = [y, y + h / 2, y + h];\n\t\t\t\t\tresult.xArr = [...result.xArr, ...xArr];\n\t\t\t\t\tresult.yArr = [...result.yArr, ...yArr];\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}, {\n\t\t\t\txArr: [],\n\t\t\t\tyArr: []\n\t\t\t});\n\t\t\treturn {\n\t\t\t\txArr: xArr.filter(item => xyObj.xArr.includes(item)),\n\t\t\t\tyArr: yArr.filter(item => xyObj.yArr.includes(item))\n\t\t\t};\n\t\t}\n\t},\n\twatch: {\n\t\t\n\t},\n\tcreated() {\n\t\t\n\t},\n\tmethods: {\n\n\t},\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.vm-align-lines {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\toverflow: hidden;\n\tz-index: 0;\n\t.__x {\n\t\tposition: absolute;\n\t\tleft: 0;\n\t\twidth: 1px;\n\t\theight: 100%;\n\t\tborder-left-width: 1px;\n\t\tborder-left-style: dotted;\n\t\tborder-left-color: #1fb6ff;\n\t\tbox-sizing: border-box;\n\t}\n\t.__y {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\twidth: 100%;\n\t\theight: 1px;\n\t\tborder-top-width: 1px;\n\t\tborder-top-style: dotted;\n\t\tborder-top-color: #1fb6ff; \n\t\tbox-sizing: border-box;\n\t}\n}\n</style>\n",".vm-align-lines {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  z-index: 0; }\n  .vm-align-lines .__x {\n    position: absolute;\n    left: 0;\n    width: 1px;\n    height: 100%;\n    border-left-width: 1px;\n    border-left-style: dotted;\n    border-left-color: #1fb6ff;\n    box-sizing: border-box; }\n  .vm-align-lines .__y {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    height: 1px;\n    border-top-width: 1px;\n    border-top-style: dotted;\n    border-top-color: #1fb6ff;\n    box-sizing: border-box; }\n\n/*# sourceMappingURL=align-lines.vue.map */"]}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$8 = "data-v-47fe399b";
  /* module identifier */
  var __vue_module_identifier__$8 = undefined;
  /* functional template */
  var __vue_is_functional_template__$8 = false;
  /* style inject SSR */
  

  
  var AlignLines = normalizeComponent_1(
    { render: __vue_render__$8, staticRenderFns: __vue_staticRenderFns__$8 },
    __vue_inject_styles__$8,
    __vue_script__$8,
    __vue_scope_id__$8,
    __vue_is_functional_template__$8,
    __vue_module_identifier__$8,
    browser,
    undefined
  );

var script$8 = {
  name: 'vm-frame',
  components: {
    'vm-draggable': Draggable,
    'vm-grid-lines': GridLines,
    'vm-align-lines': AlignLines
  },
  props: {
    width: Number,
    height: Number,
    type: {
      type: String,
      default: 'free' // sort-list

    },
    dataSource: Array,
    editor: Object
  },
  data: function data() {
    return {};
  },
  computed: {
    style: function style() {
      var w = this.width === 0 ? 'auto' : "".concat(this.width, "px");
      var h = this.height === 0 ? 'auto' : "".concat(this.height, "px");
      return {
        width: w,
        height: h
      };
    }
  },
  created: function created() {},
  methods: {
    handleDragOver: function handleDragOver(e) {},
    handleDragEnd: function handleDragEnd(e) {
      console.log(e);
    },
    handleDrop: function handleDrop(e) {
      var mod = e.dataTransfer.getData('vm-modules');
      var result = this.$parent.$options.modules[mod]; // 不存在的模块

      if (!result) { return; }

      var _this$$el$getBounding = this.$el.getBoundingClientRect(),
          x = _this$$el$getBounding.x,
          y = _this$$el$getBounding.y;

      var mouseX = e.pageX || e.clientX + doc.scrollLeft;
      var mouseY = e.pageY || e.clientY + doc.scrollTop;
      var id = getUid();
      var index = this.dataSource.length; // 会同步到上级 这里不用this.$emit("update:sync")

      this.dataSource.push(_objectSpread({}, cloneDeep(result.data), {
        module: mod,
        id: id,
        x: mouseX - x,
        y: mouseY - y
      }));
      this.$emit('change', {
        type: 'create',
        index: index,
        id: id
      }); // 新元素处于激活状态

      this.setActived(index);
    },
    handleEnd: function handleEnd(old, id, index) {
      this.$emit('change', {
        type: 'update',
        id: id,
        index: index,
        old: old
      });
    },
    setActived: function setActived(index) {
      var _this = this;

      this.$nextTick(function () {
        try {
          _this.$refs.draggable[index].setActived();
        } catch (e) {
          console.error(e);
        }
      });
    }
  }
};

/* script */
var __vue_script__$9 = script$8;

/* template */
var __vue_render__$9 = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c(
    "div",
    {
      staticStyle: { position: "relative" },
      style: _vm.style,
      on: {
        dragover: function($event) {
          $event.preventDefault();
          return _vm.handleDragOver($event)
        },
        dragend: _vm.handleDragEnd,
        drop: _vm.handleDrop
      }
    },
    [
      _c("vm-grid-lines", {
        attrs: { width: _vm.width, height: _vm.height, grid: [10, 10] }
      }),
      _vm._v(" "),
      _c("vm-align-lines", {
        attrs: { "data-source": _vm.dataSource, editor: _vm.editor }
      }),
      _vm._v(" "),
      _vm._l(_vm.dataSource, function(it, index) {
        return _c(
          "vm-draggable",
          {
            key: it.id,
            ref: "draggable",
            refInFor: true,
            attrs: {
              x: it.x,
              y: it.y,
              z: it.z,
              w: it.w,
              h: it.h,
              r: it.r,
              parent: it.parent,
              disable: it.disable,
              handles: it.handles,
              minw: it.minw,
              minh: it.minh,
              zoom: it.zoom,
              grid: it.grid,
              restrain: it.restrain
            },
            on: {
              "update:x": function($event) {
                return _vm.$set(it, "x", $event)
              },
              "update:y": function($event) {
                return _vm.$set(it, "y", $event)
              },
              "update:z": function($event) {
                return _vm.$set(it, "z", $event)
              },
              "update:w": function($event) {
                return _vm.$set(it, "w", $event)
              },
              "update:h": function($event) {
                return _vm.$set(it, "h", $event)
              },
              "update:r": function($event) {
                return _vm.$set(it, "r", $event)
              },
              activated: function($event) {
                return _vm.$emit("activated", it)
              },
              deactivated: function($event) {
                return _vm.$emit("deactivated", it)
              },
              dragging: function($event) {
                return _vm.$emit("dragging", it)
              },
              resizing: function($event) {
                return _vm.$emit("resizing", it)
              },
              rotating: function($event) {
                return _vm.$emit("rotating", it)
              },
              "resize-end": function($event) {
                return _vm.$emit("resize-end", it)
              },
              "drag-end": function($event) {
                return _vm.$emit("drag-end", it)
              },
              end: function($event) {
                return _vm.handleEnd(arguments[0], it.id, index)
              }
            }
          },
          [
            _c(
              "vm-" + it.module + "-viewer",
              _vm._b({ tag: "component" }, "component", it, false)
            )
          ],
          1
        )
      })
    ],
    2
  )
};
var __vue_staticRenderFns__$9 = [];
__vue_render__$9._withStripped = true;

  /* style */
  var __vue_inject_styles__$9 = function (inject) {
    if (!inject) { return }
    inject("data-v-3ec10b9d_0", { source: "\n/*# sourceMappingURL=frame.vue.map */", map: {"version":3,"sources":["frame.vue"],"names":[],"mappings":";AACA,oCAAoC","file":"frame.vue"}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$9 = "data-v-3ec10b9d";
  /* module identifier */
  var __vue_module_identifier__$9 = undefined;
  /* functional template */
  var __vue_is_functional_template__$9 = false;
  /* style inject SSR */
  

  
  var Frame = normalizeComponent_1(
    { render: __vue_render__$9, staticRenderFns: __vue_staticRenderFns__$9 },
    __vue_inject_styles__$9,
    __vue_script__$9,
    __vue_scope_id__$9,
    __vue_is_functional_template__$9,
    __vue_module_identifier__$9,
    browser,
    undefined
  );

//
var script$9 = {
  name: 'vm-tools-widget',
  components: {},
  props: {
    width: Number,
    height: Number,
    type: {
      type: String,
      default: 'free' // sort-list

    },
    dataSource: Array
  },
  data: function data() {
    var modules = this.$parent.$options.modules;
    var toolsList = {};

    for (var key in modules) {
      if (hasOwn(modules, key)) {
        var item = modules[key];
        var type = item.type || 'undefined';

        if (!toolsList[type]) {
          toolsList[type] = [];
        }

        toolsList[type].push({
          module: item.module,
          component: item.Widget || item.name
        });
      }
    }

    return {
      toolsList: toolsList
    };
  },
  computed: {
    style: function style() {
      var w = this.width === 0 ? 'auto' : "".concat(this.width, "px");
      var h = this.height === 0 ? 'auto' : "".concat(this.height, "px");
      return {
        width: w,
        height: h
      };
    }
  },
  created: function created() {// console.log(this.$options.modules);
  },
  methods: {
    handleStart: function handleStart(e, item) {
      e.dataTransfer.setData('vm-modules', item);
    }
  }
};

/* script */
var __vue_script__$a = script$9;

/* template */
var __vue_render__$a = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c(
    "div",
    { staticClass: "vm-tools-widget", style: _vm.style },
    _vm._l(_vm.toolsList, function(item, key) {
      return _c(
        "div",
        { key: key },
        [
          key !== "undefined"
            ? _c("div", { staticClass: "__title" }, [
                _vm._v("\n\t\t\t" + _vm._s(key) + "\t\t\n\t\t")
              ])
            : _vm._e(),
          _vm._v(" "),
          _vm._l(item, function(it) {
            return _c(
              "div",
              {
                key: it.module,
                staticClass: "__item",
                attrs: { draggable: "" },
                on: {
                  dragstart: function($event) {
                    return _vm.handleStart($event, it.module)
                  }
                }
              },
              [
                typeof it.component === "string"
                  ? _c("span", [_vm._v(_vm._s(it.component))])
                  : _c("vm-" + it.module + "-widget", { tag: "component" })
              ],
              1
            )
          })
        ],
        2
      )
    }),
    0
  )
};
var __vue_staticRenderFns__$a = [];
__vue_render__$a._withStripped = true;

  /* style */
  var __vue_inject_styles__$a = function (inject) {
    if (!inject) { return }
    inject("data-v-74d768f9_0", { source: ".vm-tools-widget[data-v-74d768f9] {\n  width: 400px;\n}\n.vm-tools-widget .__title[data-v-74d768f9] {\n    padding: 15px;\n    font-size: 18px;\n}\n.vm-tools-widget .__item[data-v-74d768f9] {\n    display: inline-block;\n    border: 1px solid gray;\n    background-color: white;\n    line-height: 30px;\n    text-align: center;\n    width: 70px;\n    margin: 0 15px 15px 15px;\n    cursor: move;\n    border-radius: 3px;\n}\n\n/*# sourceMappingURL=widget.vue.map */", map: {"version":3,"sources":["/Users/deot/Desktop/wya/github/wya-vm/src/combo/tools/widget.vue","widget.vue"],"names":[],"mappings":"AA+EA;EACA,YAAA;AAAA;AADA;IAGA,aAAA;IACA,eAAA;AAAA;AAJA;IAOA,qBAAA;IACA,sBAAA;IACA,uBAAA;IACA,iBAAA;IACA,kBAAA;IACA,WAAA;IACA,wBAAA;IACA,YAAA;IACA,kBAAA;AAAA;;AC9EA,qCAAqC","file":"widget.vue","sourcesContent":["<template>\n\t<div :style=\"style\" class=\"vm-tools-widget\">\n\t\t<div v-for=\"(item, key) in toolsList\" :key=\"key\">\n\t\t\t<div v-if=\"key !== 'undefined'\" class=\"__title\">\n\t\t\t\t{{ key }}\t\t\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tv-for=\"(it) in item\" \n\t\t\t\t:key=\"it.module\" \n\t\t\t\tclass=\"__item\" \n\t\t\t\tdraggable \n\t\t\t\t@dragstart=\"handleStart($event, it.module)\"\n\t\t\t>\n\t\t\t\t<span v-if=\"typeof it.component === 'string'\">{{ it.component }}</span>\n\t\t\t\t<component v-else :is=\"`vm-${it.module}-widget`\"/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { hasOwn } from '../../utils/helper';\n\nexport default {\n\tname: 'vm-tools-widget',\n\tcomponents: {\n\t},\n\tprops: {\n\t\twidth: Number,\n\t\theight: Number,\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\tdefault: 'free' // sort-list\n\t\t},\n\t\tdataSource: Array\n\t},\n\tdata() {\n\t\tconst { modules } = this.$parent.$options;\n\t\tlet toolsList = {};\n\t\tfor (let key in modules) {\n\t\t\tif (hasOwn(modules, key)) {\n\t\t\t\tlet item = modules[key];\n\t\t\t\tlet type = item.type || 'undefined';\n\t\t\t\tif (!toolsList[type]) {\n\t\t\t\t\ttoolsList[type] = [];\n\t\t\t\t}\n\t\t\t\ttoolsList[type].push({\n\t\t\t\t\tmodule: item.module,\n\t\t\t\t\tcomponent: item.Widget || item.name\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\ttoolsList\n\t\t};\n\t},\n\tcomputed: {\n\t\tstyle() {\n\t\t\tconst w = this.width === 0 ? 'auto' : `${this.width}px`;\n\t\t\tconst h = this.height === 0 ? 'auto' : `${this.height}px`;\n\n\t\t\treturn {\n\t\t\t\twidth: w,\n\t\t\t\theight: h\n\t\t\t};\n\t\t}\n\t},\n\tcreated() {\n\t\t// console.log(this.$options.modules);\n\t},\n\tmethods: {\n\t\thandleStart(e, item) {\n\t\t\te.dataTransfer.setData('vm-modules', item);\n\t\t}\n\t},\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.vm-tools-widget {\n\twidth: 400px;\n\t.__title {\n\t\tpadding: 15px;\n\t\tfont-size: 18px;\n\t}\n\t.__item {\n\t\tdisplay: inline-block;\n\t\tborder: 1px solid gray;\n\t\tbackground-color: white;\n\t\tline-height: 30px;\n\t\ttext-align: center;\n\t\twidth: 70px;\n\t\tmargin: 0 15px 15px 15px;\n\t\tcursor: move;\n\t\tborder-radius: 3px;\n\t}\n}\n\n</style>\n",".vm-tools-widget {\n  width: 400px; }\n  .vm-tools-widget .__title {\n    padding: 15px;\n    font-size: 18px; }\n  .vm-tools-widget .__item {\n    display: inline-block;\n    border: 1px solid gray;\n    background-color: white;\n    line-height: 30px;\n    text-align: center;\n    width: 70px;\n    margin: 0 15px 15px 15px;\n    cursor: move;\n    border-radius: 3px; }\n\n/*# sourceMappingURL=widget.vue.map */"]}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$a = "data-v-74d768f9";
  /* module identifier */
  var __vue_module_identifier__$a = undefined;
  /* functional template */
  var __vue_is_functional_template__$a = false;
  /* style inject SSR */
  

  
  var ToolsWidget = normalizeComponent_1(
    { render: __vue_render__$a, staticRenderFns: __vue_staticRenderFns__$a },
    __vue_inject_styles__$a,
    __vue_script__$a,
    __vue_scope_id__$a,
    __vue_is_functional_template__$a,
    __vue_module_identifier__$a,
    browser,
    undefined
  );

var script$a = {
  name: 'vm-editor',
  components: {},
  props: {
    dataSource: Object
  },
  data: function data() {
    return {};
  },
  computed: {},
  created: function created() {},
  methods: {
    /**
     * hack操作
     * 业务上避免使用该操作
     */
    handleChange: function handleChange() {
      var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      if (_typeof(opts) !== 'object') { return; }

      for (var key in opts) {
        var val = opts[key];
        ['x', 'y', 'z', 'r', 'w', 'h'].includes(key) && (val = Number(val));

        if (hasOwn(opts, key) && !valueIsNaN(val)) {
          this.$emit('change', {
            type: 'update',
            id: this.dataSource.id,
            old: _defineProperty({}, key, val)
          });
          this.$refs.target.$emit("update:".concat(key), val);
        }
      }
    }
  }
};

/* script */
var __vue_script__$b = script$a;

/* template */
var __vue_render__$b = function() {
  var _vm = this;
  var _h = _vm.$createElement;
  var _c = _vm._self._c || _h;
  return _c(
    "vm-" + _vm.dataSource.module + "-editor",
    _vm._b(
      {
        ref: "target",
        tag: "component",
        staticClass: "vm-editor vm-hack-editor",
        on: { change: _vm.handleChange }
      },
      "component",
      _vm.dataSource,
      false,
      true
    )
  )
};
var __vue_staticRenderFns__$b = [];
__vue_render__$b._withStripped = true;

  /* style */
  var __vue_inject_styles__$b = function (inject) {
    if (!inject) { return }
    inject("data-v-557535b5_0", { source: "\n/*# sourceMappingURL=editor.vue.map */", map: {"version":3,"sources":["editor.vue"],"names":[],"mappings":";AACA,qCAAqC","file":"editor.vue"}, media: undefined });

  };
  /* scoped */
  var __vue_scope_id__$b = "data-v-557535b5";
  /* module identifier */
  var __vue_module_identifier__$b = undefined;
  /* functional template */
  var __vue_is_functional_template__$b = false;
  /* style inject SSR */
  

  
  var Editor$1 = normalizeComponent_1(
    { render: __vue_render__$b, staticRenderFns: __vue_staticRenderFns__$b },
    __vue_inject_styles__$b,
    __vue_script__$b,
    __vue_scope_id__$b,
    __vue_is_functional_template__$b,
    __vue_module_identifier__$b,
    browser,
    undefined
  );

var root = (function () {
  var modules = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultModules;
  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  try {
    var newCombo = cloneDeep(opts.Combo || Combo);
    var newFrame = cloneDeep(opts.Frame || Frame);
    var newToolsWidget = cloneDeep(opts.ToolsWidget || ToolsWidget);
    var newToolsPreview = cloneDeep(opts.ToolsPreview || ToolsPreview);
    var newEditor = cloneDeep(opts.Editor || Editor$1);
    var viewers = {};
    var editors = {};
    var widgets = {};
    Object.keys(modules).forEach(function (item, index) {
      var _modules$item = modules[item],
          _Vditor = _modules$item.Viewer,
          _Editor = _modules$item.Editor,
          _Widget = _modules$item.Widget;
      viewers["vm-".concat(item, "-viewer")] = _Vditor;
      editors["vm-".concat(item, "-editor")] = _Editor;
      widgets["vm-".concat(item, "-widget")] = _Widget;
    }); // $options

    newCombo.modules = modules;
    newCombo.viewers = viewers;
    newCombo.editors = editors; // components

    newFrame.components = _objectSpread({}, newFrame.components, viewers);
    newEditor.components = _objectSpread({}, newEditor.components, editors);
    newToolsWidget.components = _objectSpread({}, newToolsWidget.components, widgets);
    newCombo.components = _objectSpread({}, newCombo.components, {
      'vm-frame': newFrame,
      'vm-editor': newEditor,
      'vm-tools-widget': newToolsWidget
    });
    newToolsPreview.components = _objectSpread({}, newToolsPreview.components, viewers); // cloneDeep 避免相互干扰，vue内部会改变_Ctor缓存

    return {
      Combo: cloneDeep(newCombo),
      Preview: cloneDeep(newToolsPreview)
    };
  } catch (e) {
    console.error("[wya-vm/register]", e);
    throw new Error(e);
  }
});

exports.Draggable = Draggable;
exports.createVMDrags = root;
